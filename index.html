<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestão Comercial</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    * {
      box-sizing: border-box;
    }

    .toast {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media print {
      body * {
        visibility: hidden;
      }
      #print-area, #print-area * {
        visibility: visible;
      }
      #print-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .no-print {
        display: none !important;
      }
    }

    .sidebar-transition {
      transition: transform 0.3s ease-in-out;
    }

    @media (max-width: 767px) {
      .sidebar-mobile-hidden {
        transform: translateX(-100%);
      }
      .sidebar-mobile-visible {
        transform: translateX(0);
      }
    }

    .card-hover {
      transition: all 0.2s ease;
    }

    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    }

    .stat-card {
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    }

    .nav-link {
      position: relative;
      overflow: hidden;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 3px;
      background: #2563eb;
      transform: scaleY(0);
      transition: transform 0.2s ease;
    }

    .nav-link.active::before {
      transform: scaleY(1);
    }

    .table-row-hover:hover {
      background-color: #f8fafc;
      transition: background-color 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
    }

    .btn-primary:hover {
      box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
      transform: translateY(-1px);
    }

    .input-focus:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .status-badge {
      font-weight: 600;
      letter-spacing: 0.025em;
      text-transform: uppercase;
      font-size: 0.7rem;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-50">
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
  <div id="modal-container"></div>
  <div class="h-full flex flex-col"><!-- Header -->
   <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 md:px-6 py-3 md:py-4 flex justify-between items-center shadow-lg no-print border-b border-blue-800">
    <div class="flex items-center gap-3 md:gap-4"><button id="mobile-menu-btn" class="md:hidden text-white hover:bg-blue-700 p-2 rounded-lg transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg></button>
     <div class="flex items-center gap-3">
      <div class="hidden md:flex w-10 h-10 bg-white bg-opacity-20 rounded-lg items-center justify-center">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
       </svg>
      </div>
      <h1 id="page-title" class="text-lg md:text-2xl font-bold tracking-tight">Dashboard</h1>
     </div>
    </div>
    <div id="current-date" class="text-xs md:text-sm opacity-90 hidden sm:block"></div>
   </header>
   <div class="flex-1 flex overflow-hidden"><!-- Sidebar -->
    <aside id="sidebar" class="sidebar-transition fixed md:relative z-40 w-64 md:w-72 bg-white shadow-2xl h-full sidebar-mobile-hidden md:sidebar-mobile-visible border-r border-gray-100">
     <div class="p-5 border-b border-gray-100 bg-gradient-to-br from-blue-50 to-white">
      <div class="flex items-start justify-between gap-3">
       <div class="flex-1 min-w-0">
        <h2 id="empresa-nome" class="text-lg font-bold text-gray-800 truncate">Minha Empresa</h2>
        <p id="empresa-slogan" class="text-xs text-gray-500 mt-0.5 truncate">Seu slogan aqui</p>
       </div><button onclick="navigate('configuracoes')" class="flex-shrink-0 p-1.5 bg-white rounded-lg hover:bg-blue-50 transition-all shadow-sm hover:shadow border border-gray-100" title="Configurar Empresa">
        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg></button>
      </div>
     </div>
     <nav class="p-3 overflow-y-auto h-full"><a href="#dashboard" class="nav-link active flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
       </svg><span class="text-sm font-medium">Dashboard</span> </a> <a href="#novo-pedido" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
       </svg><span class="text-sm font-medium">Novo Pedido</span> </a> <a href="#listar-pedidos" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
       </svg><span class="text-sm font-medium">Listar Pedidos</span> </a>
      <div class="px-3 py-2 mt-4 mb-1">
       <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Cadastros</p>
      </div><a href="#clientes" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
       </svg><span class="text-sm font-medium">Clientes</span> </a> <a href="#estoque" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
       </svg><span class="text-sm font-medium">Estoque</span> </a>
      <div class="px-3 py-2 mt-4 mb-1">
       <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Gestão</p>
      </div><a href="#financas" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
       </svg><span class="text-sm font-medium">Finanças</span> </a> <a href="#agenda" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
       </svg><span class="text-sm font-medium">Agenda</span> </a> <a href="#relatorios" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg><span class="text-sm font-medium">Relatórios</span> </a>
      <div class="px-3 py-2 mt-4 mb-1">
       <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Sistema</p>
      </div><a href="#configuracoes" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
       </svg><span class="text-sm font-medium">Info da Empresa</span> </a> <a href="#config-avancadas" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-all">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
       </svg><span class="text-sm font-medium">Configurações</span> </a>
     </nav>
    </aside><!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div><!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-4 md:p-6">
     <div id="main-content"></div>
    </main>
   </div>
  </div>
  <script>
    // Dados Hardcoded
    const PRODUTOS = [
      { id: 'p1', nome: 'Smartphone Galaxy X', categoria: 'Eletrônicos', preco: 2499.00, estoque: 15, estoqueMinimo: 5 },
      { id: 'p2', nome: 'Notebook Pro 15"', categoria: 'Eletrônicos', preco: 4299.00, estoque: 8, estoqueMinimo: 3 },
      { id: 'p3', nome: 'Mouse Gamer RGB', categoria: 'Acessórios', preco: 149.90, estoque: 45, estoqueMinimo: 10 },
      { id: 'p4', nome: 'Teclado Mecânico', categoria: 'Acessórios', preco: 349.90, estoque: 22, estoqueMinimo: 8 },
      { id: 'p5', nome: 'Monitor 27" 144Hz', categoria: 'Eletrônicos', preco: 1899.00, estoque: 12, estoqueMinimo: 5 },
      { id: 'p6', nome: 'Webcam Full HD', categoria: 'Acessórios', preco: 299.00, estoque: 3, estoqueMinimo: 5 },
      { id: 'p7', nome: 'Headset Wireless', categoria: 'Áudio', preco: 599.00, estoque: 18, estoqueMinimo: 6 },
      { id: 'p8', nome: 'SSD 1TB NVMe', categoria: 'Armazenamento', preco: 449.00, estoque: 25, estoqueMinimo: 10 },
      { id: 'p9', nome: 'Impressora Multifuncional', categoria: 'Escritório', preco: 899.00, estoque: 7, estoqueMinimo: 3 },
      { id: 'p10', nome: 'Roteador Wi-Fi 6', categoria: 'Rede', preco: 379.00, estoque: 2, estoqueMinimo: 5 }
    ];

    const CLIENTES = [
      { id: 'c1', nome: 'João Silva', email: 'joao.silva@email.com', telefone: '(11) 98765-4321', whatsapp: '(11) 98765-4321', endereco: 'Rua das Flores, 123, São Paulo - SP' },
      { id: 'c2', nome: 'Maria Santos', email: 'maria.santos@email.com', telefone: '(11) 97654-3210', whatsapp: '(11) 97654-3210', endereco: 'Av. Paulista, 1000, São Paulo - SP' },
      { id: 'c3', nome: 'Pedro Oliveira', email: 'pedro.oliveira@email.com', telefone: '(11) 96543-2109', whatsapp: '(11) 96543-2109', endereco: 'Rua Augusta, 456, São Paulo - SP' },
      { id: 'c4', nome: 'Ana Costa', email: 'ana.costa@email.com', telefone: '(11) 95432-1098', whatsapp: '(11) 95432-1098', endereco: 'Rua da Consolação, 789, São Paulo - SP' },
      { id: 'c5', nome: 'Carlos Ferreira', email: 'carlos.ferreira@email.com', telefone: '(11) 94321-0987', whatsapp: '(11) 94321-0987', endereco: 'Av. Rebouças, 321, São Paulo - SP' },
      { id: 'c6', nome: 'Juliana Lima', email: 'juliana.lima@email.com', telefone: '(11) 93210-9876', whatsapp: '(11) 93210-9876', endereco: 'Rua Oscar Freire, 654, São Paulo - SP' },
      { id: 'c7', nome: 'Roberto Alves', email: 'roberto.alves@email.com', telefone: '(11) 92109-8765', whatsapp: '(11) 92109-8765', endereco: 'Av. Faria Lima, 987, São Paulo - SP' },
      { id: 'c8', nome: 'Fernanda Souza', email: 'fernanda.souza@email.com', telefone: '(11) 91098-7654', whatsapp: '(11) 91098-7654', endereco: 'Rua Haddock Lobo, 234, São Paulo - SP' },
      { id: 'c9', nome: 'Ricardo Mendes', email: 'ricardo.mendes@email.com', telefone: '(11) 90987-6543', whatsapp: '(11) 90987-6543', endereco: 'Av. Ibirapuera, 567, São Paulo - SP' },
      { id: 'c10', nome: 'Patrícia Rocha', email: 'patricia.rocha@email.com', telefone: '(11) 89876-5432', whatsapp: '(11) 89876-5432', endereco: 'Rua Vergueiro, 890, São Paulo - SP' }
    ];

    const FORMAS_PAGAMENTO = ['Dinheiro', 'Cartão de Crédito', 'Cartão de Débito', 'PIX', 'Boleto', 'Sinal agora + restante depois'];
    const STATUS_PEDIDO = ['Pendente', 'Cancelado', 'Orçamento'];

    // Estado Global
    let allPedidos = [];
    let allFinancas = [];
    let allAgendamentos = [];
    let currentPage = 'dashboard';
    let isLoading = false;

    // Config
    const defaultConfig = {
      empresa_nome: 'Minha Empresa',
      empresa_slogan: 'Seu slogan aqui',
      empresa_cnpj: '',
      empresa_cnae: '',
      empresa_endereco: '',
      empresa_telefone: '',
      empresa_email: '',
      empresa_site: '',
      empresa_logo: ''
    };

    // Element SDK
    async function onConfigChange(config) {
      const nomeElement = document.getElementById('empresa-nome');
      const sloganElement = document.getElementById('empresa-slogan');
      
      if (nomeElement) {
        nomeElement.textContent = config.empresa_nome || defaultConfig.empresa_nome;
      }
      if (sloganElement) {
        sloganElement.textContent = config.empresa_slogan || defaultConfig.empresa_slogan;
      }
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['empresa_nome', config.empresa_nome || defaultConfig.empresa_nome],
        ['empresa_slogan', config.empresa_slogan || defaultConfig.empresa_slogan]
      ]);
    }

    // Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allPedidos = data.filter(item => item.tipo === 'pedido');
        allFinancas = data.filter(item => item.tipo === 'financas');
        allAgendamentos = data.filter(item => item.tipo === 'agendamento');
        
        if (currentPage === 'dashboard') {
          renderDashboard();
        } else if (currentPage === 'listar-pedidos') {
          renderListarPedidos();
        } else if (currentPage === 'financas') {
          renderFinancas();
        } else if (currentPage === 'agenda') {
          renderAgenda();
        }
      }
    };

    // Inicialização
    async function init() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('Erro ao inicializar sistema', 'error');
        }
      }

      setupNavigation();
      setupMobileMenu();
      updateDateTime();
      setInterval(updateDateTime, 60000);
      
      navigate('dashboard');
    }

    // Navegação
    function setupNavigation() {
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const page = link.getAttribute('href').substring(1);
          navigate(page);
          
          if (window.innerWidth < 768) {
            toggleMobileMenu();
          }
        });
      });
    }

    function navigate(page) {
      currentPage = page;
      
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active', 'bg-blue-50', 'text-blue-600');
      });
      
      const activeLink = document.querySelector(`a[href="#${page}"]`);
      if (activeLink) {
        activeLink.classList.add('active', 'bg-blue-50', 'text-blue-600');
      }
      
      const titles = {
        'dashboard': 'Dashboard',
        'novo-pedido': 'Novo Pedido',
        'listar-pedidos': 'Listar Pedidos',
        'clientes': 'Clientes',
        'estoque': 'Estoque',
        'financas': 'Finanças',
        'agenda': 'Agenda',
        'relatorios': 'Relatórios',
        'configuracoes': 'Informações da Empresa',
        'config-avancadas': 'Configurações'
      };
      
      document.getElementById('page-title').textContent = titles[page] || 'Dashboard';
      
      switch(page) {
        case 'dashboard':
          renderDashboard();
          break;
        case 'novo-pedido':
          renderNovoPedido();
          break;
        case 'listar-pedidos':
          renderListarPedidos();
          break;
        case 'clientes':
          renderClientes();
          break;
        case 'estoque':
          renderEstoque();
          break;
        case 'financas':
          renderFinancas();
          break;
        case 'agenda':
          renderAgenda();
          break;
        case 'relatorios':
          renderRelatorios();
          break;
        case 'configuracoes':
          renderConfiguracoes();
          break;
        case 'config-avancadas':
          renderConfigAvancadas();
          break;
      }
    }

    // Mobile Menu
    function setupMobileMenu() {
      const menuBtn = document.getElementById('mobile-menu-btn');
      const overlay = document.getElementById('mobile-overlay');
      
      menuBtn.addEventListener('click', toggleMobileMenu);
      overlay.addEventListener('click', toggleMobileMenu);
    }

    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobile-overlay');
      
      sidebar.classList.toggle('sidebar-mobile-hidden');
      sidebar.classList.toggle('sidebar-mobile-visible');
      overlay.classList.toggle('hidden');
    }

    // Utilitários
    function updateDateTime() {
      const now = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      document.getElementById('current-date').textContent = now.toLocaleDateString('pt-BR', options);
    }

    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    function formatDateTime(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('pt-BR', { 
        day: '2-digit', 
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const colors = {
        success: 'bg-green-600',
        error: 'bg-red-600',
        warning: 'bg-yellow-600',
        info: 'bg-blue-600'
      };
      
      toast.className = `toast ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 max-w-md`;
      toast.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        </button>
      `;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 5000);
    }

    function showModal(content) {
      const container = document.getElementById('modal-container');
      container.innerHTML = `
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-y-auto">
          <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            ${content}
          </div>
        </div>
      `;
    }

    function closeModal() {
      document.getElementById('modal-container').innerHTML = '';
    }

    // RENDERIZAÇÕES
    
    function renderDashboard() {
      const totalPedidos = allPedidos.length;
      const totalVendas = allPedidos
        .filter(p => p.status === 'Concluído')
        .reduce((sum, p) => sum + p.total, 0);
      
      const clientesUnicos = new Set(allPedidos.map(p => p.clienteId)).size;
      
      const produtosBaixoEstoque = PRODUTOS.filter(p => p.estoque <= p.estoqueMinimo);
      
      const produtosVendidos = {};
      allPedidos.forEach(pedido => {
        if (pedido.status === 'Concluído') {
          const produtos = JSON.parse(pedido.produtos);
          produtos.forEach(item => {
            produtosVendidos[item.id] = (produtosVendidos[item.id] || 0) + item.quantidade;
          });
        }
      });
      
      const topProdutos = Object.entries(produtosVendidos)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5)
        .map(([id, qty]) => ({
          produto: PRODUTOS.find(p => p.id === id),
          quantidade: qty
        }));
      
      const pedidosRecentes = [...allPedidos]
        .sort((a, b) => new Date(b.data) - new Date(a.data))
        .slice(0, 5);
      
      const now = new Date();
      const mesAtual = now.getMonth();
      const anoAtual = now.getFullYear();
      
      const entradasMes = allFinancas
        .filter(f => f.tipo_transacao === 'entrada' && new Date(f.data).getMonth() === mesAtual && new Date(f.data).getFullYear() === anoAtual)
        .reduce((sum, f) => sum + f.valor, 0);
      
      const saidasMes = allFinancas
        .filter(f => f.tipo_transacao === 'saida' && new Date(f.data).getMonth() === mesAtual && new Date(f.data).getFullYear() === anoAtual)
        .reduce((sum, f) => sum + f.valor, 0);
      
      const lucroMes = entradasMes - saidasMes;
      
      const agendamentosProximos = [...allAgendamentos]
        .filter(a => new Date(a.data_hora) >= new Date() && a.status !== 'Cancelado')
        .sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora))
        .slice(0, 5);
      
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <!-- Cards de Estatísticas -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500 text-sm">Total de Pedidos</p>
                <p class="text-3xl font-bold text-blue-600 mt-2">${totalPedidos}</p>
              </div>
              <div class="bg-blue-100 p-3 rounded-full">
                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500 text-sm">Total em Vendas</p>
                <p class="text-3xl font-bold text-green-600 mt-2">${formatCurrency(totalVendas)}</p>
              </div>
              <div class="bg-green-100 p-3 rounded-full">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500 text-sm">Lucro do Mês</p>
                <p class="text-3xl font-bold ${lucroMes >= 0 ? 'text-green-600' : 'text-red-600'} mt-2">${formatCurrency(lucroMes)}</p>
              </div>
              <div class="${lucroMes >= 0 ? 'bg-green-100' : 'bg-red-100'} p-3 rounded-full">
                <svg class="w-8 h-8 ${lucroMes >= 0 ? 'text-green-600' : 'text-red-600'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500 text-sm">Agendamentos Hoje</p>
                <p class="text-3xl font-bold text-purple-600 mt-2">${agendamentosProximos.filter(a => {
                  const agendData = new Date(a.data_hora);
                  return agendData.toDateString() === new Date().toDateString();
                }).length}</p>
              </div>
              <div class="bg-purple-100 p-3 rounded-full">
                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>

        ${produtosBaixoEstoque.length > 0 ? `
          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">Atenção: Estoque Baixo</h3>
                <div class="mt-2 text-sm text-yellow-700">
                  <ul class="list-disc list-inside">
                    ${produtosBaixoEstoque.map(p => `
                      <li>${p.nome} - Apenas ${p.estoque} unidades restantes</li>
                    `).join('')}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        ` : ''}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Pedidos Recentes -->
          <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-lg font-bold text-gray-800">Pedidos Recentes</h2>
            </div>
            <div class="p-6">
              ${pedidosRecentes.length > 0 ? `
                <div class="space-y-4">
                  ${pedidosRecentes.map(pedido => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                      <div class="flex-1">
                        <p class="font-medium text-gray-800">${pedido.cliente}</p>
                        <p class="text-sm text-gray-500">${formatDate(pedido.data)}</p>
                      </div>
                      <div class="text-right">
                        <p class="font-bold text-gray-800">${formatCurrency(pedido.total)}</p>
                        <span class="inline-block px-2 py-1 text-xs font-semibold rounded ${
                          pedido.status === 'Concluído' ? 'bg-green-100 text-green-800' :
                          pedido.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                          'bg-red-100 text-red-800'
                        }">${pedido.status}</span>
                      </div>
                    </div>
                  `).join('')}
                </div>
              ` : '<p class="text-gray-500 text-center py-8">Nenhum pedido registrado ainda</p>'}
            </div>
          </div>

          <!-- Próximos Agendamentos -->
          <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-lg font-bold text-gray-800">Próximos Agendamentos</h2>
            </div>
            <div class="p-6">
              ${agendamentosProximos.length > 0 ? `
                <div class="space-y-4">
                  ${agendamentosProximos.map(agend => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                      <div class="flex-1">
                        <p class="font-medium text-gray-800">${agend.cliente}</p>
                        <p class="text-sm text-gray-500">${formatDateTime(agend.data_hora)}</p>
                        <p class="text-xs text-gray-400 mt-1">${agend.servico}</p>
                      </div>
                      <div class="text-right">
                        <span class="inline-block px-2 py-1 text-xs font-semibold rounded ${
                          agend.status === 'Confirmado' ? 'bg-green-100 text-green-800' :
                          agend.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                          'bg-red-100 text-red-800'
                        }">${agend.status}</span>
                      </div>
                    </div>
                  `).join('')}
                </div>
              ` : '<p class="text-gray-500 text-center py-8">Nenhum agendamento próximo</p>'}
            </div>
          </div>
        </div>
      `;
    }

    function renderNovoPedido() {
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="max-w-6xl mx-auto">
          <!-- Barra de Progresso -->
          <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
              <div class="flex-1 flex items-center">
                <div id="step-1" class="flex items-center">
                  <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">1</div>
                  <div class="ml-3 hidden sm:block">
                    <p class="text-sm font-semibold text-gray-800">Cliente</p>
                  </div>
                </div>
                <div class="flex-1 h-1 bg-gray-200 mx-2"></div>
                <div id="step-2" class="flex items-center">
                  <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center font-bold">2</div>
                  <div class="ml-3 hidden sm:block">
                    <p class="text-sm font-semibold text-gray-400">Produtos</p>
                  </div>
                </div>
                <div class="flex-1 h-1 bg-gray-200 mx-2"></div>
                <div id="step-3" class="flex items-center">
                  <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center font-bold">3</div>
                  <div class="ml-3 hidden sm:block">
                    <p class="text-sm font-semibold text-gray-400">Pagamento</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="bg-gray-200 h-2 rounded-full overflow-hidden">
              <div id="progress-bar" class="bg-blue-600 h-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-center text-sm text-gray-500 mt-2"><span id="progress-text">0%</span> progresso</p>
          </div>

          <!-- Etapa 1: Informações do Cliente -->
          <div id="etapa-1" class="bg-white rounded-lg shadow-lg">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-2xl font-bold text-gray-800">1. Informações do Cliente</h2>
              <p class="text-gray-600 mt-1">Selecione o cliente para este pedido</p>
            </div>
            <div class="p-6">
              <div class="space-y-6">
                <!-- Tipo de Cliente -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-3">Tipo de Cliente</label>
                  <div class="flex gap-4">
                    <label class="flex-1 cursor-pointer">
                      <input type="radio" name="tipo-cliente" value="recorrente" checked class="hidden peer">
                      <div class="border-2 border-gray-300 rounded-lg p-4 text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 hover:border-blue-400 transition-all">
                        <svg class="w-8 h-8 mx-auto mb-2 text-gray-600 peer-checked:text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <p class="font-semibold text-gray-800">Cliente Recorrente</p>
                      </div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                      <input type="radio" name="tipo-cliente" value="novo" class="hidden peer">
                      <div class="border-2 border-gray-300 rounded-lg p-4 text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 hover:border-blue-400 transition-all">
                        <svg class="w-8 h-8 mx-auto mb-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                        <p class="font-semibold text-gray-800">Cliente Novo</p>
                      </div>
                    </label>
                  </div>
                </div>

                <!-- Cliente Recorrente -->
                <div id="area-cliente-recorrente">
                  <label for="select-cliente-recorrente" class="block text-sm font-medium text-gray-700 mb-2">
                    Selecione o Cliente *
                  </label>
                  <div class="relative">
                    <input type="text" id="search-cliente" placeholder="Digite o nome do cliente..."
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <div id="lista-clientes" class="hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                      ${CLIENTES.sort((a, b) => a.nome.localeCompare(b.nome)).map(cliente => `
                        <div class="cliente-item px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100" data-id="${cliente.id}">
                          <p class="font-semibold text-gray-800">${cliente.nome}</p>
                          <p class="text-sm text-gray-500">${cliente.telefone}</p>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                  <input type="hidden" id="cliente-selecionado-id">
                  <div id="cliente-selecionado-info" class="hidden mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="font-semibold text-gray-800 mb-2">Cliente Selecionado:</p>
                    <div class="space-y-1 text-sm">
                      <p><span class="font-medium">Nome:</span> <span id="info-nome"></span></p>
                      <p><span class="font-medium">Email:</span> <span id="info-email"></span></p>
                      <p><span class="font-medium">Telefone:</span> <span id="info-telefone"></span></p>
                      <p><span class="font-medium">Endereço:</span> <span id="info-endereco"></span></p>
                    </div>
                  </div>
                </div>

                <!-- Cliente Novo -->
                <div id="area-cliente-novo" class="hidden space-y-4">
                  <div>
                    <label for="novo-cliente-nome" class="block text-sm font-medium text-gray-700 mb-2">
                      Nome Completo *
                    </label>
                    <input type="text" id="novo-cliente-nome" 
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="novo-cliente-email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email
                      </label>
                      <input type="email" id="novo-cliente-email" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                      <label for="novo-cliente-telefone" class="block text-sm font-medium text-gray-700 mb-2">
                        Telefone/WhatsApp *
                      </label>
                      <input type="tel" id="novo-cliente-telefone" placeholder="(00) 00000-0000"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                  </div>
                  <div>
                    <label for="novo-cliente-endereco" class="block text-sm font-medium text-gray-700 mb-2">
                      Endereço
                    </label>
                    <textarea id="novo-cliente-endereco" rows="2"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
                  </div>
                </div>

                <!-- Tipo de Pedido -->
                <div>
                  <label for="tipo-pedido" class="block text-sm font-medium text-gray-700 mb-2">
                    Selecione o Tipo *
                  </label>
                  <select id="tipo-pedido" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">Selecione...</option>
                    <option value="Orçamento">Orçamento</option>
                    <option value="Venda">Venda</option>
                  </select>
                </div>
              </div>

              <div class="mt-6 flex justify-end">
                <button onclick="avancarParaEtapa2()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2">
                  Avançar para Produtos
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Etapa 2: Seleção de Produtos -->
          <div id="etapa-2" class="hidden bg-white rounded-lg shadow-lg">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-2xl font-bold text-gray-800">2. Seleção de Produtos</h2>
              <p class="text-gray-600 mt-1">Adicione os produtos do pedido</p>
            </div>
            <div class="p-6">
              <button onclick="abrirModalAdicionarProduto()" class="w-full px-6 py-4 border-2 border-dashed border-blue-300 text-blue-600 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all font-semibold flex items-center justify-center gap-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Adicionar Produto
              </button>

              <div id="lista-produtos-pedido" class="mt-6">
                <div id="produtos-vazio" class="text-center py-12 text-gray-400">
                  <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                  </svg>
                  <p class="font-semibold text-lg">Nenhum produto adicionado</p>
                  <p class="text-sm mt-2">Clique em "Adicionar Produto" para começar</p>
                </div>
                <div id="produtos-lista" class="hidden space-y-3"></div>
              </div>

              <div class="mt-6 flex gap-3">
                <button onclick="voltarParaEtapa1()" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                  Voltar
                </button>
                <button onclick="avancarParaEtapa3()" class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center justify-center gap-2">
                  Avançar para Pagamento
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Etapa 3: Pagamento e Finalização -->
          <div id="etapa-3" class="hidden bg-white rounded-lg shadow-lg">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-2xl font-bold text-gray-800">3. Pagamento e Finalização</h2>
              <p class="text-gray-600 mt-1">Defina forma de pagamento e desconto</p>
            </div>
            <div class="p-6 space-y-6">
              <!-- Forma de Pagamento -->
              <div>
                <label for="forma-pagamento" class="block text-sm font-medium text-gray-700 mb-2">
                  Forma de Pagamento *
                </label>
                <select id="forma-pagamento" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  <option value="">Selecione...</option>
                  <option value="Dinheiro">Dinheiro</option>
                  <option value="Cartão de Crédito">Cartão de Crédito</option>
                  <option value="Cartão de Débito">Cartão de Débito</option>
                  <option value="PIX">PIX</option>
                  <option value="Boleto">Boleto</option>
                  <option value="Sinal + Parcelado">Sinal agora + restante parcelado</option>
                </select>
              </div>

              <!-- Opções Dinheiro -->
              <div id="opcoes-dinheiro" class="hidden space-y-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <div>
                  <label for="valor-recebido" class="block text-sm font-medium text-gray-700 mb-2">
                    Valor Recebido <span class="text-xs text-gray-500">(ex: R$ 2.500,00)</span>
                  </label>
                  <input type="text" id="valor-recebido" placeholder="R$ 0,00"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                <div class="p-4 bg-white rounded-lg border border-green-300">
                  <p class="text-sm text-gray-600 mb-1">Troco a devolver:</p>
                  <p id="valor-troco" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                </div>
              </div>

              <!-- Opções Sinal + Parcelado -->
              <div id="opcoes-sinal-parcelado" class="hidden space-y-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                <div>
                  <label for="valor-sinal" class="block text-sm font-medium text-gray-700 mb-2">
                    Valor do Sinal <span class="text-xs text-gray-500">(ex: R$ 2.500,00)</span>
                  </label>
                  <input type="text" id="valor-sinal" placeholder="R$ 0,00"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                  <label for="forma-pagamento-restante" class="block text-sm font-medium text-gray-700 mb-2">
                    Forma de Pagamento do Restante
                  </label>
                  <select id="forma-pagamento-restante" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="">Selecione...</option>
                    <option value="Dinheiro">Dinheiro</option>
                    <option value="Cartão de Crédito">Cartão de Crédito</option>
                    <option value="Cartão de Débito">Cartão de Débito</option>
                    <option value="PIX">PIX</option>
                    <option value="Boleto">Boleto</option>
                  </select>
                </div>
                <div>
                  <label for="data-proximo-pagamento" class="block text-sm font-medium text-gray-700 mb-2">
                    Data do Próximo Pagamento
                  </label>
                  <input type="date" id="data-proximo-pagamento"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div class="p-4 bg-white rounded-lg border border-purple-300">
                  <p class="text-sm text-gray-600 mb-1">Valor Restante:</p>
                  <p id="valor-restante" class="text-2xl font-bold text-purple-600">R$ 0,00</p>
                </div>
              </div>

              <!-- Desconto -->
              <div>
                <label for="desconto" class="block text-sm font-medium text-gray-700 mb-2">
                  Desconto (%)
                </label>
                <input type="number" id="desconto" value="0" min="0" max="100" step="0.1"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <!-- Resumo do Pedido -->
              <div class="p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Resumo do Pedido</h3>
                <div class="space-y-2">
                  <div class="flex justify-between text-gray-700">
                    <span>Subtotal:</span>
                    <span id="resumo-subtotal" class="font-semibold">R$ 0,00</span>
                  </div>
                  <div class="flex justify-between text-gray-700">
                    <span>Desconto:</span>
                    <span id="resumo-desconto" class="font-semibold text-red-600">- R$ 0,00</span>
                  </div>
                  <div class="border-t-2 border-blue-300 pt-2 mt-2">
                    <div class="flex justify-between items-center">
                      <span class="text-xl font-bold text-gray-800">Total do Pedido:</span>
                      <span id="resumo-total" class="text-3xl font-bold text-blue-600">R$ 0,00</span>
                    </div>
                  </div>
                  <div class="flex justify-between text-sm text-gray-600 pt-2">
                    <span>Itens:</span>
                    <span id="resumo-itens" class="font-semibold">0</span>
                  </div>
                </div>
              </div>

              <div class="flex gap-3">
                <button onclick="voltarParaEtapa2()" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                  Voltar
                </button>
                <button onclick="finalizarPedido()" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-colors font-bold flex items-center justify-center gap-2 shadow-lg">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  Finalizar Pedido
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      setupNovoPedido();
    }

    // Estado do Novo Pedido
    let novoPedidoState = {
      etapaAtual: 1,
      clienteId: null,
      clienteNovo: null,
      tipoPedido: '',
      produtos: [],
      subtotal: 0,
      desconto: 0,
      total: 0,
      formaPagamento: '',
      dadosPagamento: {}
    };

    function setupNovoPedido() {
      // Radio tipo de cliente
      document.querySelectorAll('input[name="tipo-cliente"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          if (e.target.value === 'recorrente') {
            document.getElementById('area-cliente-recorrente').classList.remove('hidden');
            document.getElementById('area-cliente-novo').classList.add('hidden');
          } else {
            document.getElementById('area-cliente-recorrente').classList.add('hidden');
            document.getElementById('area-cliente-novo').classList.remove('hidden');
          }
        });
      });

      // Busca de cliente
      const searchInput = document.getElementById('search-cliente');
      const listaClientes = document.getElementById('lista-clientes');
      
      searchInput.addEventListener('focus', () => {
        listaClientes.classList.remove('hidden');
      });

      searchInput.addEventListener('input', (e) => {
        const termo = e.target.value.toLowerCase();
        document.querySelectorAll('.cliente-item').forEach(item => {
          const nome = item.querySelector('p').textContent.toLowerCase();
          if (nome.includes(termo)) {
            item.classList.remove('hidden');
          } else {
            item.classList.add('hidden');
          }
        });
      });

      // Seleção de cliente
      document.querySelectorAll('.cliente-item').forEach(item => {
        item.addEventListener('click', () => {
          const clienteId = item.dataset.id;
          const cliente = CLIENTES.find(c => c.id === clienteId);
          
          document.getElementById('cliente-selecionado-id').value = clienteId;
          document.getElementById('search-cliente').value = cliente.nome;
          document.getElementById('info-nome').textContent = cliente.nome;
          document.getElementById('info-email').textContent = cliente.email;
          document.getElementById('info-telefone').textContent = cliente.telefone;
          document.getElementById('info-endereco').textContent = cliente.endereco;
          document.getElementById('cliente-selecionado-info').classList.remove('hidden');
          listaClientes.classList.add('hidden');
        });
      });

      document.addEventListener('click', (e) => {
        if (!searchInput.contains(e.target) && !listaClientes.contains(e.target)) {
          listaClientes.classList.add('hidden');
        }
      });

      // Forma de pagamento
      const formaPagamentoSelect = document.getElementById('forma-pagamento');
      formaPagamentoSelect.addEventListener('change', (e) => {
        document.getElementById('opcoes-dinheiro').classList.add('hidden');
        document.getElementById('opcoes-sinal-parcelado').classList.add('hidden');
        
        if (e.target.value === 'Dinheiro') {
          document.getElementById('opcoes-dinheiro').classList.remove('hidden');
        } else if (e.target.value === 'Sinal + Parcelado') {
          document.getElementById('opcoes-sinal-parcelado').classList.remove('hidden');
        }
      });

      // Formatação monetária para valor recebido
      const valorRecebidoInput = document.getElementById('valor-recebido');
      if (valorRecebidoInput) {
        valorRecebidoInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value === '') {
            e.target.value = '';
            calcularTroco();
            return;
          }
          
          value = (parseInt(value) / 100).toFixed(2);
          e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
          calcularTroco();
        });
      }

      // Formatação monetária para valor sinal
      const valorSinalInput = document.getElementById('valor-sinal');
      if (valorSinalInput) {
        valorSinalInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value === '') {
            e.target.value = '';
            calcularRestante();
            return;
          }
          
          value = (parseInt(value) / 100).toFixed(2);
          e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
          calcularRestante();
        });
      }

      // Cálculo desconto
      document.getElementById('desconto')?.addEventListener('input', atualizarResumo);
    }

    function parseMoneyInput(value) {
      if (!value) return 0;
      const cleanValue = value.replace(/[^\d,]/g, '').replace(',', '.');
      return parseFloat(cleanValue) || 0;
    }

    function calcularTroco() {
      const valorRecebidoStr = document.getElementById('valor-recebido').value;
      const valorRecebido = parseMoneyInput(valorRecebidoStr);
      const total = novoPedidoState.total;
      const troco = Math.max(0, valorRecebido - total);
      document.getElementById('valor-troco').textContent = formatCurrency(troco);
    }

    function calcularRestante() {
      const valorSinalStr = document.getElementById('valor-sinal').value;
      const valorSinal = parseMoneyInput(valorSinalStr);
      const total = novoPedidoState.total;
      const restante = Math.max(0, total - valorSinal);
      document.getElementById('valor-restante').textContent = formatCurrency(restante);
    }

    function atualizarProgresso(etapa) {
      const progresso = (etapa - 1) * 50;
      document.getElementById('progress-bar').style.width = progresso + '%';
      document.getElementById('progress-text').textContent = progresso + '%';

      for (let i = 1; i <= 3; i++) {
        const stepDiv = document.getElementById(`step-${i}`).querySelector('div');
        const stepText = document.getElementById(`step-${i}`).querySelector('p');
        
        if (i < etapa) {
          stepDiv.className = 'w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center font-bold';
          if (stepText) stepText.className = 'text-sm font-semibold text-green-600';
        } else if (i === etapa) {
          stepDiv.className = 'w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold';
          if (stepText) stepText.className = 'text-sm font-semibold text-gray-800';
        } else {
          stepDiv.className = 'w-10 h-10 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center font-bold';
          if (stepText) stepText.className = 'text-sm font-semibold text-gray-400';
        }
      }
    }

    function avancarParaEtapa2() {
      const tipoCliente = document.querySelector('input[name="tipo-cliente"]:checked').value;
      
      if (tipoCliente === 'recorrente') {
        const clienteId = document.getElementById('cliente-selecionado-id').value;
        if (!clienteId) {
          showToast('Por favor, selecione um cliente', 'warning');
          return;
        }
        novoPedidoState.clienteId = clienteId;
      } else {
        const nome = document.getElementById('novo-cliente-nome').value;
        const telefone = document.getElementById('novo-cliente-telefone').value;
        
        if (!nome || !telefone) {
          showToast('Preencha os campos obrigatórios do cliente', 'warning');
          return;
        }
        
        novoPedidoState.clienteNovo = {
          nome,
          email: document.getElementById('novo-cliente-email').value,
          telefone,
          endereco: document.getElementById('novo-cliente-endereco').value
        };
      }

      const tipoPedido = document.getElementById('tipo-pedido').value;
      if (!tipoPedido) {
        showToast('Selecione o tipo de pedido', 'warning');
        return;
      }
      novoPedidoState.tipoPedido = tipoPedido;

      document.getElementById('etapa-1').classList.add('hidden');
      document.getElementById('etapa-2').classList.remove('hidden');
      novoPedidoState.etapaAtual = 2;
      atualizarProgresso(2);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function voltarParaEtapa1() {
      document.getElementById('etapa-2').classList.add('hidden');
      document.getElementById('etapa-1').classList.remove('hidden');
      novoPedidoState.etapaAtual = 1;
      atualizarProgresso(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function avancarParaEtapa3() {
      if (novoPedidoState.produtos.length === 0) {
        showToast('Adicione pelo menos um produto ao pedido', 'warning');
        return;
      }

      document.getElementById('etapa-2').classList.add('hidden');
      document.getElementById('etapa-3').classList.remove('hidden');
      novoPedidoState.etapaAtual = 3;
      atualizarProgresso(3);
      atualizarResumo();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function voltarParaEtapa2() {
      document.getElementById('etapa-3').classList.add('hidden');
      document.getElementById('etapa-2').classList.remove('hidden');
      novoPedidoState.etapaAtual = 2;
      atualizarProgresso(2);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function abrirModalAdicionarProduto() {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Adicionar Produto</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <div class="space-y-4 max-h-96 overflow-y-auto">
            ${PRODUTOS.map(produto => `
              <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-400 hover:bg-blue-50 transition-all">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex-1">
                    <h4 class="font-bold text-gray-800">${produto.nome}</h4>
                    <p class="text-sm text-gray-500">${produto.categoria}</p>
                    <p class="text-lg font-bold text-blue-600 mt-1">${formatCurrency(produto.preco)}</p>
                    <p class="text-xs text-gray-500 mt-1">Estoque: ${produto.estoque} unidades</p>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <label class="text-sm font-medium text-gray-700">Quantidade:</label>
                  <input type="number" id="qty-${produto.id}" value="1" min="1" max="${produto.estoque}" 
                    class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  <button onclick='adicionarProdutoAoPedido(${JSON.stringify(produto)})' 
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                    Adicionar
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `);
    }

    function adicionarProdutoAoPedido(produto) {
      const quantidade = parseInt(document.getElementById(`qty-${produto.id}`).value) || 1;
      
      if (quantidade > produto.estoque) {
        showToast('Quantidade maior que o estoque disponível', 'error');
        return;
      }

      const itemExistente = novoPedidoState.produtos.find(p => p.id === produto.id);
      
      if (itemExistente) {
        itemExistente.quantidade += quantidade;
      } else {
        novoPedidoState.produtos.push({
          ...produto,
          quantidade
        });
      }

      atualizarListaProdutos();
      closeModal();
      showToast('Produto adicionado ao pedido', 'success');
    }

    function atualizarListaProdutos() {
      const listaDiv = document.getElementById('produtos-lista');
      const vazioDiv = document.getElementById('produtos-vazio');

      if (novoPedidoState.produtos.length === 0) {
        listaDiv.classList.add('hidden');
        vazioDiv.classList.remove('hidden');
        novoPedidoState.subtotal = 0;
        return;
      }

      vazioDiv.classList.add('hidden');
      listaDiv.classList.remove('hidden');

      let subtotal = 0;
      listaDiv.innerHTML = novoPedidoState.produtos.map((item, index) => {
        const totalItem = item.preco * item.quantidade;
        subtotal += totalItem;
        
        return `
          <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex-1">
              <h4 class="font-bold text-gray-800">${item.nome}</h4>
              <p class="text-sm text-gray-500">${formatCurrency(item.preco)} x ${item.quantidade}</p>
            </div>
            <div class="text-right">
              <p class="font-bold text-gray-800">${formatCurrency(totalItem)}</p>
            </div>
            <button onclick="removerProduto(${index})" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        `;
      }).join('');

      novoPedidoState.subtotal = subtotal;
    }

    function removerProduto(index) {
      novoPedidoState.produtos.splice(index, 1);
      atualizarListaProdutos();
      showToast('Produto removido', 'info');
    }

    function atualizarResumo() {
      const desconto = parseFloat(document.getElementById('desconto')?.value || 0);
      const valorDesconto = (novoPedidoState.subtotal * desconto) / 100;
      const total = novoPedidoState.subtotal - valorDesconto;

      novoPedidoState.desconto = desconto;
      novoPedidoState.total = total;

      document.getElementById('resumo-subtotal').textContent = formatCurrency(novoPedidoState.subtotal);
      document.getElementById('resumo-desconto').textContent = '- ' + formatCurrency(valorDesconto);
      document.getElementById('resumo-total').textContent = formatCurrency(total);
      document.getElementById('resumo-itens').textContent = novoPedidoState.produtos.reduce((sum, p) => sum + p.quantidade, 0);

      calcularTroco();
      calcularRestante();
    }

    async function finalizarPedido() {
      const formaPagamento = document.getElementById('forma-pagamento').value;
      if (!formaPagamento) {
        showToast('Selecione a forma de pagamento', 'warning');
        return;
      }

      if (allPedidos.length >= 999) {
        showToast('Limite máximo de 999 pedidos atingido. Delete alguns pedidos primeiro.', 'error');
        return;
      }

      const clienteNome = novoPedidoState.clienteId 
        ? CLIENTES.find(c => c.id === novoPedidoState.clienteId).nome
        : novoPedidoState.clienteNovo.nome;

      const pedido = {
        tipo: 'pedido',
        clienteId: novoPedidoState.clienteId || 'novo',
        cliente: clienteNome,
        data: new Date().toISOString(),
        produtos: JSON.stringify(novoPedidoState.produtos),
        subtotal: novoPedidoState.subtotal,
        desconto: novoPedidoState.desconto,
        total: novoPedidoState.total,
        formaPagamento: formaPagamento,
        status: novoPedidoState.tipoPedido
      };

      if (formaPagamento === 'Dinheiro') {
        const valorRecebidoStr = document.getElementById('valor-recebido').value;
        const valorRecebido = parseMoneyInput(valorRecebidoStr);
        pedido.valorRecebido = valorRecebido;
        pedido.troco = Math.max(0, valorRecebido - novoPedidoState.total);
      } else if (formaPagamento === 'Sinal + Parcelado') {
        const valorSinalStr = document.getElementById('valor-sinal').value;
        const valorSinal = parseMoneyInput(valorSinalStr);
        pedido.valorSinal = valorSinal;
        pedido.formaPagamentoRestante = document.getElementById('forma-pagamento-restante').value;
        pedido.dataProximoPagamento = document.getElementById('data-proximo-pagamento').value;
        pedido.valorRestante = Math.max(0, novoPedidoState.total - valorSinal);
      }

      if (window.dataSdk) {
        const result = await window.dataSdk.create(pedido);
        
        if (result.isOk) {
          showToast('Pedido criado com sucesso!', 'success');
          novoPedidoState = {
            etapaAtual: 1,
            clienteId: null,
            clienteNovo: null,
            tipoPedido: '',
            produtos: [],
            subtotal: 0,
            desconto: 0,
            total: 0,
            formaPagamento: '',
            dadosPagamento: {}
          };
          navigate('listar-pedidos');
        } else {
          showToast('Erro ao criar pedido: ' + result.error.message, 'error');
        }
      }
    }
    
    function renderListarPedidos() {
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg">
          <div class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
              <h2 class="text-2xl font-bold text-gray-800">Pedidos</h2>
              <button onclick="navigate('novo-pedido')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Novo Pedido
              </button>
            </div>
          </div>
          
          <div class="p-6">
            ${allPedidos.length > 0 ? `
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pagamento</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    ${allPedidos.map(pedido => `
                      <tr class="table-row-hover">
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${pedido.cliente}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(pedido.data)}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-gray-900">${formatCurrency(pedido.total)}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${pedido.formaPagamento}</td>
                        <td class="px-4 py-4 whitespace-nowrap">
                          <select onchange='alterarStatusPedido(${JSON.stringify(pedido)}, this.value)' 
                            class="status-badge px-2 py-1 text-xs font-semibold rounded-full border-none cursor-pointer ${
                              pedido.status === 'Venda' ? 'bg-green-100 text-green-800' :
                              pedido.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                              pedido.status === 'Cancelado' ? 'bg-red-100 text-red-800' :
                              'bg-blue-100 text-blue-800'
                            }">
                            <option value="Venda" ${pedido.status === 'Venda' ? 'selected' : ''}>VENDA</option>
                            <option value="Orçamento" ${pedido.status === 'Orçamento' ? 'selected' : ''}>ORÇAMENTO</option>
                            <option value="Pendente" ${pedido.status === 'Pendente' ? 'selected' : ''}>PENDENTE</option>
                            <option value="Cancelado" ${pedido.status === 'Cancelado' ? 'selected' : ''}>CANCELADO</option>
                          </select>
                        </td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                          <button onclick='verPedido(${JSON.stringify(pedido)})' class="text-blue-600 hover:text-blue-900 mr-3">Ver</button>
                          <button onclick='excluirPedido(${JSON.stringify(pedido)})' class="text-red-600 hover:text-red-900">Excluir</button>
                        </td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            ` : `
              <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhum pedido</h3>
                <p class="mt-1 text-sm text-gray-500">Comece criando um novo pedido.</p>
              </div>
            `}
          </div>
        </div>
      `;
    }
    
    function renderClientes() {
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800">Clientes</h2>
          </div>
          
          <div class="p-6">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">WhatsApp</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${CLIENTES.map(cliente => `
                    <tr class="table-row-hover">
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${cliente.nome}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${cliente.email}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${cliente.telefone}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                        <a href="https://wa.me/${cliente.whatsapp.replace(/\D/g, '')}" target="_blank" rel="noopener noreferrer" class="text-green-600 hover:text-green-700 flex items-center gap-1">
                          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                          </svg>
                          ${cliente.whatsapp}
                        </a>
                      </td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick='editarCliente(${JSON.stringify(cliente)})' class="text-blue-600 hover:text-blue-900 mr-3 inline-flex items-center gap-1">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                          </svg>
                          Editar
                        </button>
                        <button onclick='excluirCliente(${JSON.stringify(cliente)})' class="text-red-600 hover:text-red-900 inline-flex items-center gap-1">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                          </svg>
                          Excluir
                        </button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    function editarCliente(cliente) {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Editar Cliente</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-editar-cliente" class="space-y-4">
            <div>
              <label for="edit-cliente-nome" class="block text-sm font-medium text-gray-700 mb-2">
                Nome Completo *
              </label>
              <input type="text" id="edit-cliente-nome" value="${cliente.nome}" required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-cliente-email" class="block text-sm font-medium text-gray-700 mb-2">
                Email
              </label>
              <input type="email" id="edit-cliente-email" value="${cliente.email}"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-cliente-telefone" class="block text-sm font-medium text-gray-700 mb-2">
                Telefone *
              </label>
              <input type="tel" id="edit-cliente-telefone" value="${cliente.telefone}" required
                placeholder="(00) 00000-0000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-cliente-whatsapp" class="block text-sm font-medium text-gray-700 mb-2">
                WhatsApp *
              </label>
              <input type="tel" id="edit-cliente-whatsapp" value="${cliente.whatsapp}" required
                placeholder="(00) 00000-0000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-cliente-endereco" class="block text-sm font-medium text-gray-700 mb-2">
                Endereço
              </label>
              <textarea id="edit-cliente-endereco" rows="3"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none">${cliente.endereco}</textarea>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                Salvar Alterações
              </button>
            </div>
          </form>
        </div>
      `);

      document.getElementById('form-editar-cliente').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const clienteAtualizado = {
          ...cliente,
          nome: document.getElementById('edit-cliente-nome').value,
          email: document.getElementById('edit-cliente-email').value,
          telefone: document.getElementById('edit-cliente-telefone').value,
          whatsapp: document.getElementById('edit-cliente-whatsapp').value,
          endereco: document.getElementById('edit-cliente-endereco').value
        };

        const index = CLIENTES.findIndex(c => c.id === cliente.id);
        if (index !== -1) {
          CLIENTES[index] = clienteAtualizado;
        }

        showToast('Cliente atualizado com sucesso!', 'success');
        closeModal();
        renderClientes();
      });
    }

    function excluirCliente(cliente) {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Confirmar Exclusão</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <div class="mb-6">
            <div class="flex items-center justify-center w-16 h-16 mx-auto bg-red-100 rounded-full mb-4">
              <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
            </div>
            <p class="text-center text-gray-700 text-lg mb-2">
              Tem certeza que deseja excluir o cliente?
            </p>
            <p class="text-center text-gray-900 font-bold text-xl mb-4">
              ${cliente.nome}
            </p>
            <p class="text-center text-sm text-gray-500">
              Esta ação não pode ser desfeita.
            </p>
          </div>

          <div class="flex gap-3">
            <button onclick="closeModal()" 
              class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
              Cancelar
            </button>
            <button onclick="confirmarExclusaoCliente('${cliente.id}')" 
              class="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
              Sim, Excluir
            </button>
          </div>
        </div>
      `);
    }

    function confirmarExclusaoCliente(clienteId) {
      const index = CLIENTES.findIndex(c => c.id === clienteId);
      if (index !== -1) {
        CLIENTES.splice(index, 1);
      }

      showToast('Cliente excluído com sucesso!', 'success');
      closeModal();
      renderClientes();
    }
    
    function renderEstoque() {
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg">
          <div class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
              <h2 class="text-2xl font-bold text-gray-800">Estoque</h2>
              <button onclick="abrirModalNovoProduto()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Adicionar Produto
              </button>
            </div>
          </div>
          
          <div class="p-6">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produto</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preço</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estoque</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${PRODUTOS.map(produto => `
                    <tr class="table-row-hover">
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${produto.nome}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${produto.categoria}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-gray-900">${formatCurrency(produto.preco)}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${produto.estoque} unidades</td>
                      <td class="px-4 py-4 whitespace-nowrap">
                        <span class="status-badge px-2 py-1 inline-flex leading-5 rounded-full ${
                          produto.estoque > produto.estoqueMinimo ? 'bg-green-100 text-green-800' :
                          produto.estoque === produto.estoqueMinimo ? 'bg-yellow-100 text-yellow-800' :
                          'bg-red-100 text-red-800'
                        }">
                          ${produto.estoque > produto.estoqueMinimo ? 'Normal' :
                            produto.estoque === produto.estoqueMinimo ? 'Atenção' :
                            'Crítico'}
                        </span>
                      </td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick='editarProduto(${JSON.stringify(produto)})' class="text-blue-600 hover:text-blue-900 mr-3 inline-flex items-center gap-1">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                          </svg>
                          Editar
                        </button>
                        <button onclick='excluirProduto(${JSON.stringify(produto)})' class="text-red-600 hover:text-red-900 inline-flex items-center gap-1">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                          </svg>
                          Excluir
                        </button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    function abrirModalNovoProduto() {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Adicionar Novo Produto</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-novo-produto" class="space-y-4">
            <div>
              <label for="novo-prod-nome" class="block text-sm font-medium text-gray-700 mb-2">
                Nome do Produto *
              </label>
              <input type="text" id="novo-prod-nome" required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="novo-prod-categoria" class="block text-sm font-medium text-gray-700 mb-2">
                Categoria *
              </label>
              <input type="text" id="novo-prod-categoria" required
                placeholder="Ex: Eletrônicos, Acessórios, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="novo-prod-preco" class="block text-sm font-medium text-gray-700 mb-2">
                  Preço (R$) *
                </label>
                <input type="text" id="novo-prod-preco" required
                  placeholder="R$ 0,00"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label for="novo-prod-estoque" class="block text-sm font-medium text-gray-700 mb-2">
                  Quantidade em Estoque *
                </label>
                <input type="number" id="novo-prod-estoque" required min="0"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="novo-prod-estoque-minimo" class="block text-sm font-medium text-gray-700 mb-2">
                Estoque Mínimo *
              </label>
              <input type="number" id="novo-prod-estoque-minimo" required min="0"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p class="text-xs text-gray-500 mt-1">Você será alertado quando o estoque atingir este valor</p>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                Adicionar Produto
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação de preço
      const precoInput = document.getElementById('novo-prod-preco');
      precoInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') {
          e.target.value = '';
          return;
        }
        
        value = (parseInt(value) / 100).toFixed(2);
        e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      });

      document.getElementById('form-novo-produto').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const novoProduto = {
          id: 'p' + Date.now(),
          nome: document.getElementById('novo-prod-nome').value,
          categoria: document.getElementById('novo-prod-categoria').value,
          preco: parseMoneyInput(document.getElementById('novo-prod-preco').value),
          estoque: parseInt(document.getElementById('novo-prod-estoque').value),
          estoqueMinimo: parseInt(document.getElementById('novo-prod-estoque-minimo').value)
        };

        PRODUTOS.push(novoProduto);

        showToast('Produto adicionado com sucesso!', 'success');
        closeModal();
        renderEstoque();
      });
    }

    function editarProduto(produto) {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Editar Produto</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-editar-produto" class="space-y-4">
            <div>
              <label for="edit-prod-nome" class="block text-sm font-medium text-gray-700 mb-2">
                Nome do Produto *
              </label>
              <input type="text" id="edit-prod-nome" value="${produto.nome}" required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-prod-categoria" class="block text-sm font-medium text-gray-700 mb-2">
                Categoria *
              </label>
              <input type="text" id="edit-prod-categoria" value="${produto.categoria}" required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="edit-prod-preco" class="block text-sm font-medium text-gray-700 mb-2">
                  Preço (R$) *
                </label>
                <input type="text" id="edit-prod-preco" value="${formatCurrency(produto.preco)}" required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label for="edit-prod-estoque" class="block text-sm font-medium text-gray-700 mb-2">
                  Quantidade em Estoque *
                </label>
                <input type="number" id="edit-prod-estoque" value="${produto.estoque}" required min="0"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="edit-prod-estoque-minimo" class="block text-sm font-medium text-gray-700 mb-2">
                Estoque Mínimo *
              </label>
              <input type="number" id="edit-prod-estoque-minimo" value="${produto.estoqueMinimo}" required min="0"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p class="text-xs text-gray-500 mt-1">Você será alertado quando o estoque atingir este valor</p>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                Salvar Alterações
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação de pre����o
      const precoInput = document.getElementById('edit-prod-preco');
      precoInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') {
          e.target.value = '';
          return;
        }
        
        value = (parseInt(value) / 100).toFixed(2);
        e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      });

      document.getElementById('form-editar-produto').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const produtoAtualizado = {
          ...produto,
          nome: document.getElementById('edit-prod-nome').value,
          categoria: document.getElementById('edit-prod-categoria').value,
          preco: parseMoneyInput(document.getElementById('edit-prod-preco').value),
          estoque: parseInt(document.getElementById('edit-prod-estoque').value),
          estoqueMinimo: parseInt(document.getElementById('edit-prod-estoque-minimo').value)
        };

        const index = PRODUTOS.findIndex(p => p.id === produto.id);
        if (index !== -1) {
          PRODUTOS[index] = produtoAtualizado;
        }

        showToast('Produto atualizado com sucesso!', 'success');
        closeModal();
        renderEstoque();
      });
    }

    function excluirProduto(produto) {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Confirmar Exclusão</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <div class="mb-6">
            <div class="flex items-center justify-center w-16 h-16 mx-auto bg-red-100 rounded-full mb-4">
              <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
            </div>
            <p class="text-center text-gray-700 text-lg mb-2">
              Tem certeza que deseja excluir este produto?
            </p>
            <p class="text-center text-gray-900 font-bold text-xl mb-4">
              ${produto.nome}
            </p>
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
              <div class="grid grid-cols-2 gap-3 text-sm">
                <div>
                  <p class="text-gray-500">Categoria</p>
                  <p class="font-semibold text-gray-800">${produto.categoria}</p>
                </div>
                <div>
                  <p class="text-gray-500">Preço</p>
                  <p class="font-semibold text-gray-800">${formatCurrency(produto.preco)}</p>
                </div>
                <div>
                  <p class="text-gray-500">Estoque Atual</p>
                  <p class="font-semibold text-gray-800">${produto.estoque} unidades</p>
                </div>
                <div>
                  <p class="text-gray-500">Estoque Mínimo</p>
                  <p class="font-semibold text-gray-800">${produto.estoqueMinimo} unidades</p>
                </div>
              </div>
            </div>
            <p class="text-center text-sm text-gray-500">
              Esta ação não pode ser desfeita.
            </p>
          </div>

          <div class="flex gap-3">
            <button onclick="closeModal()" 
              class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
              Cancelar
            </button>
            <button onclick="confirmarExclusaoProduto('${produto.id}')" 
              class="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
              Sim, Excluir
            </button>
          </div>
        </div>
      `);
    }

    function confirmarExclusaoProduto(produtoId) {
      const index = PRODUTOS.findIndex(p => p.id === produtoId);
      if (index !== -1) {
        PRODUTOS.splice(index, 1);
      }

      showToast('Produto excluído com sucesso!', 'success');
      closeModal();
      renderEstoque();
    }
    
    function renderFinancas() {
      const now = new Date();
      const mesAtual = now.getMonth();
      const anoAtual = now.getFullYear();
      
      const entradas = allFinancas.filter(f => 
        f.tipo_transacao === 'entrada' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      );
      
      const saidas = allFinancas.filter(f => 
        f.tipo_transacao === 'saida' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      );
      
      const despesasFixas = allFinancas.filter(f => 
        f.tipo_transacao === 'despesa_fixa' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      );
      
      const totalEntradas = entradas.reduce((sum, f) => sum + f.valor, 0);
      const totalSaidas = saidas.reduce((sum, f) => sum + f.valor, 0);
      const totalDespesasFixas = despesasFixas.reduce((sum, f) => sum + f.valor, 0);
      const lucroMes = totalEntradas - totalSaidas - totalDespesasFixas;
      
      const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                     'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
      
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="space-y-6">
          <!-- Cards de Resumo -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Entradas do Mês</p>
                  <p class="text-3xl font-bold text-green-600 mt-2">${formatCurrency(totalEntradas)}</p>
                  <p class="text-xs text-gray-400 mt-1">${entradas.length} transações</p>
                </div>
                <div class="bg-green-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-red-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Saídas do Mês</p>
                  <p class="text-3xl font-bold text-red-600 mt-2">${formatCurrency(totalSaidas)}</p>
                  <p class="text-xs text-gray-400 mt-1">${saidas.length} transações</p>
                </div>
                <div class="bg-red-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-orange-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Despesas Fixas</p>
                  <p class="text-3xl font-bold text-orange-600 mt-2">${formatCurrency(totalDespesasFixas)}</p>
                  <p class="text-xs text-gray-400 mt-1">${despesasFixas.length} despesas</p>
                </div>
                <div class="bg-orange-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 ${lucroMes >= 0 ? 'border-blue-500' : 'border-purple-500'}">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Lucro do Mês</p>
                  <p class="text-3xl font-bold ${lucroMes >= 0 ? 'text-blue-600' : 'text-purple-600'} mt-2">${formatCurrency(lucroMes)}</p>
                  <p class="text-xs text-gray-400 mt-1">${meses[mesAtual]} ${anoAtual}</p>
                </div>
                <div class="${lucroMes >= 0 ? 'bg-blue-100' : 'bg-purple-100'} p-3 rounded-full">
                  <svg class="w-8 h-8 ${lucroMes >= 0 ? 'text-blue-600' : 'text-purple-600'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Abas -->
          <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="border-b border-gray-200">
              <nav class="flex -mb-px">
                <button onclick="trocarAbaFinancas('entradas')" 
                  id="aba-entradas"
                  class="aba-financas px-6 py-4 text-sm font-medium border-b-2 border-green-500 text-green-600">
                  Entradas
                </button>
                <button onclick="trocarAbaFinancas('saidas')" 
                  id="aba-saidas"
                  class="aba-financas px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                  Saídas
                </button>
                <button onclick="trocarAbaFinancas('despesas-fixas')" 
                  id="aba-despesas-fixas"
                  class="aba-financas px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                  Despesas Fixas
                </button>
                <button onclick="trocarAbaFinancas('relatorio')" 
                  id="aba-relatorio"
                  class="aba-financas px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                  Relatório Mensal
                </button>
              </nav>
            </div>

            <div id="conteudo-aba-financas" class="p-6"></div>
          </div>
        </div>
      `;

      trocarAbaFinancas('entradas');
    }

    let abaFinancasAtual = 'entradas';

    function trocarAbaFinancas(aba) {
      abaFinancasAtual = aba;
      
      document.querySelectorAll('.aba-financas').forEach(btn => {
        btn.classList.remove('border-green-500', 'border-red-500', 'border-orange-500', 'border-blue-500', 'text-green-600', 'text-red-600', 'text-orange-600', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
      });
      
      const btnAtivo = document.getElementById(`aba-${aba}`);
      if (btnAtivo) {
        btnAtivo.classList.remove('border-transparent', 'text-gray-500');
        if (aba === 'entradas') {
          btnAtivo.classList.add('border-green-500', 'text-green-600');
        } else if (aba === 'saidas') {
          btnAtivo.classList.add('border-red-500', 'text-red-600');
        } else if (aba === 'despesas-fixas') {
          btnAtivo.classList.add('border-orange-500', 'text-orange-600');
        } else if (aba === 'relatorio') {
          btnAtivo.classList.add('border-blue-500', 'text-blue-600');
        }
      }
      
      switch(aba) {
        case 'entradas':
          renderEntradasFinancas();
          break;
        case 'saidas':
          renderSaidasFinancas();
          break;
        case 'despesas-fixas':
          renderDespesasFixas();
          break;
        case 'relatorio':
          renderRelatorioMensal();
          break;
      }
    }

    function renderEntradasFinancas() {
      const now = new Date();
      const mesAtual = now.getMonth();
      const anoAtual = now.getFullYear();
      
      const entradas = allFinancas.filter(f => 
        f.tipo_transacao === 'entrada' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      ).sort((a, b) => new Date(b.data) - new Date(a.data));
      
      const conteudo = document.getElementById('conteudo-aba-financas');
      conteudo.innerHTML = `
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-800">Entradas de ${new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
            <button onclick="abrirModalNovaEntrada()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Nova Entrada
            </button>
          </div>

          ${entradas.length > 0 ? `
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${entradas.map(entrada => `
                    <tr class="table-row-hover">
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(entrada.data)}</td>
                      <td class="px-4 py-4 text-sm text-gray-900">${entrada.descricao}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${entrada.categoria || '-'}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-green-600">${formatCurrency(entrada.valor)}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick='editarFinanca(${JSON.stringify(entrada)})' class="text-blue-600 hover:text-blue-900 mr-3">Editar</button>
                        <button onclick='excluirFinanca(${JSON.stringify(entrada)})' class="text-red-600 hover:text-red-900">Excluir</button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          ` : `
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhuma entrada</h3>
              <p class="mt-1 text-sm text-gray-500">Comece adicionando uma nova entrada.</p>
            </div>
          `}
        </div>
      `;
    }

    function renderSaidasFinancas() {
      const now = new Date();
      const mesAtual = now.getMonth();
      const anoAtual = now.getFullYear();
      
      const saidas = allFinancas.filter(f => 
        f.tipo_transacao === 'saida' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      ).sort((a, b) => new Date(b.data) - new Date(a.data));
      
      const conteudo = document.getElementById('conteudo-aba-financas');
      conteudo.innerHTML = `
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-800">Saídas de ${new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
            <button onclick="abrirModalNovaSaida()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Nova Saída
            </button>
          </div>

          ${saidas.length > 0 ? `
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${saidas.map(saida => `
                    <tr class="table-row-hover">
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(saida.data)}</td>
                      <td class="px-4 py-4 text-sm text-gray-900">${saida.descricao}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${saida.categoria || '-'}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-red-600">${formatCurrency(saida.valor)}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick='editarFinanca(${JSON.stringify(saida)})' class="text-blue-600 hover:text-blue-900 mr-3">Editar</button>
                        <button onclick='excluirFinanca(${JSON.stringify(saida)})' class="text-red-600 hover:text-red-900">Excluir</button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          ` : `
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhuma saída</h3>
              <p class="mt-1 text-sm text-gray-500">Comece adicionando uma nova saída.</p>
            </div>
          `}
        </div>
      `;
    }

    function renderDespesasFixas() {
      const now = new Date();
      const mesAtual = now.getMonth();
      const anoAtual = now.getFullYear();
      
      const despesas = allFinancas.filter(f => 
        f.tipo_transacao === 'despesa_fixa' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      ).sort((a, b) => new Date(b.data) - new Date(a.data));
      
      const conteudo = document.getElementById('conteudo-aba-financas');
      conteudo.innerHTML = `
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-800">Despesas Fixas de ${new Date().toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h3>
            <button onclick="abrirModalNovaDespesaFixa()" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Nova Despesa Fixa
            </button>
          </div>

          <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-orange-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-orange-700">
                  <strong>Despesas Fixas</strong> são gastos recorrentes mensais como internet, aluguel, água, luz, etc. 
                  Registre essas despesas para ter controle total dos seus custos fixos.
                </p>
              </div>
            </div>
          </div>

          ${despesas.length > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              ${despesas.map(despesa => `
                <div class="bg-white border-2 border-orange-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                      <h4 class="font-bold text-gray-800 text-lg">${despesa.descricao}</h4>
                      <p class="text-sm text-gray-500">${despesa.categoria || 'Sem categoria'}</p>
                    </div>
                    <div class="flex gap-2">
                      <button onclick='editarFinanca(${JSON.stringify(despesa)})' class="text-blue-600 hover:text-blue-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                      </button>
                      <button onclick='excluirFinanca(${JSON.stringify(despesa)})' class="text-red-600 hover:text-red-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="bg-orange-50 rounded-lg p-3 mb-2">
                    <p class="text-2xl font-bold text-orange-600">${formatCurrency(despesa.valor)}</p>
                    <p class="text-xs text-gray-500 mt-1">Vencimento: ${formatDate(despesa.data)}</p>
                  </div>
                  ${despesa.observacoes ? `
                    <p class="text-xs text-gray-600 mt-2">${despesa.observacoes}</p>
                  ` : ''}
                </div>
              `).join('')}
            </div>
          ` : `
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhuma despesa fixa</h3>
              <p class="mt-1 text-sm text-gray-500">Comece adicionando uma nova despesa fixa.</p>
            </div>
          `}
        </div>
      `;
    }

    function renderRelatorioMensal() {
      const now = new Date();
      const mesAtual = now.getMonth();
      const anoAtual = now.getFullYear();
      
      const entradas = allFinancas.filter(f => 
        f.tipo_transacao === 'entrada' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      );
      
      const saidas = allFinancas.filter(f => 
        f.tipo_transacao === 'saida' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      );
      
      const despesas = allFinancas.filter(f => 
        f.tipo_transacao === 'despesa_fixa' && 
        new Date(f.data).getMonth() === mesAtual && 
        new Date(f.data).getFullYear() === anoAtual
      );
      
      const totalEntradas = entradas.reduce((sum, f) => sum + f.valor, 0);
      const totalSaidas = saidas.reduce((sum, f) => sum + f.valor, 0);
      const totalDespesas = despesas.reduce((sum, f) => sum + f.valor, 0);
      const totalGeral = totalSaidas + totalDespesas;
      const lucro = totalEntradas - totalGeral;
      
      const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                     'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
      
      const conteudo = document.getElementById('conteudo-aba-financas');
      conteudo.innerHTML = `
        <div class="space-y-6">
          <div class="flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-800">Relatório de ${meses[mesAtual]} ${anoAtual}</h3>
            <button onclick="imprimirRelatorio()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
              </svg>
              Imprimir Relatório
            </button>
          </div>

          <!-- Resumo Visual -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border-2 border-green-200">
              <div class="flex items-center gap-3 mb-4">
                <div class="bg-green-500 p-3 rounded-full">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
                  </svg>
                </div>
                <h4 class="text-lg font-bold text-gray-800">Entradas</h4>
              </div>
              <p class="text-3xl font-bold text-green-600 mb-2">${formatCurrency(totalEntradas)}</p>
              <p class="text-sm text-gray-600">${entradas.length} transações</p>
            </div>

            <div class="bg-gradient-to-br from-red-50 to-pink-50 rounded-lg p-6 border-2 border-red-200">
              <div class="flex items-center gap-3 mb-4">
                <div class="bg-red-500 p-3 rounded-full">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6"></path>
                  </svg>
                </div>
                <h4 class="text-lg font-bold text-gray-800">Saídas</h4>
              </div>
              <p class="text-3xl font-bold text-red-600 mb-2">${formatCurrency(totalSaidas)}</p>
              <p class="text-sm text-gray-600">${saidas.length} transações</p>
            </div>

            <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-6 border-2 border-orange-200">
              <div class="flex items-center gap-3 mb-4">
                <div class="bg-orange-500 p-3 rounded-full">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                  </svg>
                </div>
                <h4 class="text-lg font-bold text-gray-800">Despesas Fixas</h4>
              </div>
              <p class="text-3xl font-bold text-orange-600 mb-2">${formatCurrency(totalDespesas)}</p>
              <p class="text-sm text-gray-600">${despesas.length} despesas</p>
            </div>
          </div>

          <!-- Resultado Final -->
          <div class="bg-gradient-to-r ${lucro >= 0 ? 'from-blue-600 to-indigo-600' : 'from-purple-600 to-pink-600'} rounded-lg p-8 text-white shadow-xl">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-100 text-sm font-medium mb-2">Resultado do Mês</p>
                <p class="text-5xl font-bold mb-2">${formatCurrency(lucro)}</p>
                <p class="text-blue-100 text-sm">
                  ${lucro >= 0 ? '✓ Lucro positivo' : '⚠ Prejuízo no mês'}
                </p>
              </div>
              <div class="bg-white bg-opacity-20 p-6 rounded-full">
                <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              </div>
            </div>
          </div>

          <!-- Detalhamento -->
          <div class="bg-white rounded-lg border-2 border-gray-200 overflow-hidden">
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
              <h4 class="text-lg font-bold text-gray-800">Detalhamento Financeiro</h4>
            </div>
            <div class="p-6">
              <div class="space-y-4">
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                  <span class="text-gray-700 font-medium">Total de Entradas</span>
                  <span class="text-xl font-bold text-green-600">${formatCurrency(totalEntradas)}</span>
                </div>
                <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                  <span class="text-gray-700 font-medium">Total de Saídas</span>
                  <span class="text-xl font-bold text-red-600">- ${formatCurrency(totalSaidas)}</span>
                </div>
                <div class="flex justify-between items-center pb-3 border-b-2 border-gray-300">
                  <span class="text-gray-700 font-medium">Total de Despesas Fixas</span>
                  <span class="text-xl font-bold text-orange-600">- ${formatCurrency(totalDespesas)}</span>
                </div>
                <div class="flex justify-between items-center pt-3">
                  <span class="text-xl font-bold text-gray-800">Resultado Final</span>
                  <span class="text-3xl font-bold ${lucro >= 0 ? 'text-blue-600' : 'text-purple-600'}">${formatCurrency(lucro)}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Gráfico de Pizza (Simplificado) -->
          ${(totalSaidas > 0 || totalDespesas > 0) ? `
            <div class="bg-white rounded-lg border-2 border-gray-200 p-6">
              <h4 class="text-lg font-bold text-gray-800 mb-4">Distribuição de Gastos</h4>
              <div class="flex items-center gap-6">
                <div class="flex-1">
                  <div class="space-y-3">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <div class="w-4 h-4 bg-red-500 rounded"></div>
                        <span class="text-gray-700">Saídas</span>
                      </div>
                      <span class="font-bold text-gray-800">${formatCurrency(totalSaidas)} (${totalGeral > 0 ? Math.round((totalSaidas / totalGeral) * 100) : 0}%)</span>
                    </div>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <div class="w-4 h-4 bg-orange-500 rounded"></div>
                        <span class="text-gray-700">Despesas Fixas</span>
                      </div>
                      <span class="font-bold text-gray-800">${formatCurrency(totalDespesas)} (${totalGeral > 0 ? Math.round((totalDespesas / totalGeral) * 100) : 0}%)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    function abrirModalNovaEntrada() {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Nova Entrada</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-nova-entrada" class="space-y-4">
            <div>
              <label for="entrada-descricao" class="block text-sm font-medium text-gray-700 mb-2">
                Descrição *
              </label>
              <input type="text" id="entrada-descricao" required
                placeholder="Ex: Venda de produto, Serviço prestado, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="entrada-valor" class="block text-sm font-medium text-gray-700 mb-2">
                  Valor (R$) *
                </label>
                <input type="text" id="entrada-valor" required
                  placeholder="R$ 0,00"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
              </div>

              <div>
                <label for="entrada-data" class="block text-sm font-medium text-gray-700 mb-2">
                  Data *
                </label>
                <input type="date" id="entrada-data" required
                  value="${new Date().toISOString().split('T')[0]}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="entrada-categoria" class="block text-sm font-medium text-gray-700 mb-2">
                Categoria
              </label>
              <input type="text" id="entrada-categoria"
                placeholder="Ex: Vendas, Serviços, Investimentos, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            </div>

            <div>
              <label for="entrada-observacoes" class="block text-sm font-medium text-gray-700 mb-2">
                Observações
              </label>
              <textarea id="entrada-observacoes" rows="3"
                placeholder="Informações adicionais..."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"></textarea>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                Adicionar Entrada
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação monetária
      const valorInput = document.getElementById('entrada-valor');
      valorInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') {
          e.target.value = '';
          return;
        }
        
        value = (parseInt(value) / 100).toFixed(2);
        e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      });

      document.getElementById('form-nova-entrada').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (allFinancas.length >= 999) {
          showToast('Limite máximo de 999 transações atingido. Delete algumas transações primeiro.', 'error');
          return;
        }

        const novaEntrada = {
          tipo: 'financas',
          tipo_transacao: 'entrada',
          descricao: document.getElementById('entrada-descricao').value,
          valor: parseMoneyInput(document.getElementById('entrada-valor').value),
          data: document.getElementById('entrada-data').value,
          categoria: document.getElementById('entrada-categoria').value || '',
          observacoes: document.getElementById('entrada-observacoes').value || ''
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(novaEntrada);
          
          if (result.isOk) {
            showToast('Entrada adicionada com sucesso!', 'success');
            closeModal();
          } else {
            showToast('Erro ao adicionar entrada: ' + result.error.message, 'error');
          }
        }
      });
    }

    function abrirModalNovaSaida() {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Nova Saída</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-nova-saida" class="space-y-4">
            <div>
              <label for="saida-descricao" class="block text-sm font-medium text-gray-700 mb-2">
                Descrição *
              </label>
              <input type="text" id="saida-descricao" required
                placeholder="Ex: Compra de material, Pagamento de fornecedor, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="saida-valor" class="block text-sm font-medium text-gray-700 mb-2">
                  Valor (R$) *
                </label>
                <input type="text" id="saida-valor" required
                  placeholder="R$ 0,00"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
              </div>

              <div>
                <label for="saida-data" class="block text-sm font-medium text-gray-700 mb-2">
                  Data *
                </label>
                <input type="date" id="saida-data" required
                  value="${new Date().toISOString().split('T')[0]}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="saida-categoria" class="block text-sm font-medium text-gray-700 mb-2">
                Categoria
              </label>
              <input type="text" id="saida-categoria"
                placeholder="Ex: Fornecedores, Materiais, Impostos, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
            </div>

            <div>
              <label for="saida-observacoes" class="block text-sm font-medium text-gray-700 mb-2">
                Observações
              </label>
              <textarea id="saida-observacoes" rows="3"
                placeholder="Informações adicionais..."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none"></textarea>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
                Adicionar Saída
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação monetária
      const valorInput = document.getElementById('saida-valor');
      valorInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') {
          e.target.value = '';
          return;
        }
        
        value = (parseInt(value) / 100).toFixed(2);
        e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      });

      document.getElementById('form-nova-saida').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (allFinancas.length >= 999) {
          showToast('Limite máximo de 999 transações atingido. Delete algumas transações primeiro.', 'error');
          return;
        }

        const novaSaida = {
          tipo: 'financas',
          tipo_transacao: 'saida',
          descricao: document.getElementById('saida-descricao').value,
          valor: parseMoneyInput(document.getElementById('saida-valor').value),
          data: document.getElementById('saida-data').value,
          categoria: document.getElementById('saida-categoria').value || '',
          observacoes: document.getElementById('saida-observacoes').value || ''
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(novaSaida);
          
          if (result.isOk) {
            showToast('Saída adicionada com sucesso!', 'success');
            closeModal();
          } else {
            showToast('Erro ao adicionar saída: ' + result.error.message, 'error');
          }
        }
      });
    }

    function abrirModalNovaDespesaFixa() {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Nova Despesa Fixa</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-nova-despesa" class="space-y-4">
            <div>
              <label for="despesa-descricao" class="block text-sm font-medium text-gray-700 mb-2">
                Descrição *
              </label>
              <input type="text" id="despesa-descricao" required
                placeholder="Ex: Aluguel, Internet, Luz, Água, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="despesa-valor" class="block text-sm font-medium text-gray-700 mb-2">
                  Valor (R$) *
                </label>
                <input type="text" id="despesa-valor" required
                  placeholder="R$ 0,00"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
              </div>

              <div>
                <label for="despesa-data" class="block text-sm font-medium text-gray-700 mb-2">
                  Data de Vencimento *
                </label>
                <input type="date" id="despesa-data" required
                  value="${new Date().toISOString().split('T')[0]}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="despesa-categoria" class="block text-sm font-medium text-gray-700 mb-2">
                Categoria
              </label>
              <input type="text" id="despesa-categoria"
                placeholder="Ex: Infraestrutura, Contas, Impostos, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            </div>

            <div>
              <label for="despesa-observacoes" class="block text-sm font-medium text-gray-700 mb-2">
                Observações
              </label>
              <textarea id="despesa-observacoes" rows="3"
                placeholder="Informações adicionais..."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"></textarea>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-semibold">
                Adicionar Despesa Fixa
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação monetária
      const valorInput = document.getElementById('despesa-valor');
      valorInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') {
          e.target.value = '';
          return;
        }
        
        value = (parseInt(value) / 100).toFixed(2);
        e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      });

      document.getElementById('form-nova-despesa').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (allFinancas.length >= 999) {
          showToast('Limite máximo de 999 transações atingido. Delete algumas transações primeiro.', 'error');
          return;
        }

        const novaDespesa = {
          tipo: 'financas',
          tipo_transacao: 'despesa_fixa',
          descricao: document.getElementById('despesa-descricao').value,
          valor: parseMoneyInput(document.getElementById('despesa-valor').value),
          data: document.getElementById('despesa-data').value,
          categoria: document.getElementById('despesa-categoria').value || '',
          observacoes: document.getElementById('despesa-observacoes').value || ''
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(novaDespesa);
          
          if (result.isOk) {
            showToast('Despesa fixa adicionada com sucesso!', 'success');
            closeModal();
          } else {
            showToast('Erro ao adicionar despesa: ' + result.error.message, 'error');
          }
        }
      });
    }

    function editarFinanca(financa) {
      const tipoLabel = financa.tipo_transacao === 'entrada' ? 'Entrada' :
                        financa.tipo_transacao === 'saida' ? 'Saída' : 'Despesa Fixa';
      const corTipo = financa.tipo_transacao === 'entrada' ? 'green' :
                      financa.tipo_transacao === 'saida' ? 'red' : 'orange';
      
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Editar ${tipoLabel}</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-editar-financa" class="space-y-4">
            <div>
              <label for="edit-descricao" class="block text-sm font-medium text-gray-700 mb-2">
                Descrição *
              </label>
              <input type="text" id="edit-descricao" required value="${financa.descricao}"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-${corTipo}-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="edit-valor" class="block text-sm font-medium text-gray-700 mb-2">
                  Valor (R$) *
                </label>
                <input type="text" id="edit-valor" required value="${formatCurrency(financa.valor)}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-${corTipo}-500 focus:border-transparent">
              </div>

              <div>
                <label for="edit-data" class="block text-sm font-medium text-gray-700 mb-2">
                  Data *
                </label>
                <input type="date" id="edit-data" required value="${financa.data}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-${corTipo}-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="edit-categoria" class="block text-sm font-medium text-gray-700 mb-2">
                Categoria
              </label>
              <input type="text" id="edit-categoria" value="${financa.categoria || ''}"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-${corTipo}-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-observacoes" class="block text-sm font-medium text-gray-700 mb-2">
                Observações
              </label>
              <textarea id="edit-observacoes" rows="3"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-${corTipo}-500 focus:border-transparent resize-none">${financa.observacoes || ''}</textarea>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-${corTipo}-600 text-white rounded-lg hover:bg-${corTipo}-700 transition-colors font-semibold">
                Salvar Alterações
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação monetária
      const valorInput = document.getElementById('edit-valor');
      valorInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value === '') {
          e.target.value = '';
          return;
        }
        
        value = (parseInt(value) / 100).toFixed(2);
        e.target.value = 'R$ ' + value.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      });

      document.getElementById('form-editar-financa').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const financaAtualizada = {
          ...financa,
          descricao: document.getElementById('edit-descricao').value,
          valor: parseMoneyInput(document.getElementById('edit-valor').value),
          data: document.getElementById('edit-data').value,
          categoria: document.getElementById('edit-categoria').value || '',
          observacoes: document.getElementById('edit-observacoes').value || ''
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.update(financaAtualizada);
          
          if (result.isOk) {
            showToast(`${tipoLabel} atualizada com sucesso!`, 'success');
            closeModal();
          } else {
            showToast(`Erro ao atualizar ${tipoLabel.toLowerCase()}: ` + result.error.message, 'error');
          }
        }
      });
    }

    async function excluirFinanca(financa) {
      const tipoLabel = financa.tipo_transacao === 'entrada' ? 'entrada' :
                        financa.tipo_transacao === 'saida' ? 'saída' : 'despesa fixa';
      
      if (!window.dataSdk) return;
      
      const result = await window.dataSdk.delete(financa);
      
      if (result.isOk) {
        showToast(`${tipoLabel.charAt(0).toUpperCase() + tipoLabel.slice(1)} excluída com sucesso`, 'success');
      } else {
        showToast(`Erro ao excluir ${tipoLabel}`, 'error');
      }
    }

    function imprimirRelatorio() {
      showToast('Função de impressão em desenvolvimento', 'info');
    }
    
    function renderAgenda() {
      const now = new Date();
      const hoje = now.toDateString();
      
      const agendamentosHoje = allAgendamentos.filter(a => {
        const dataAgend = new Date(a.data_hora);
        return dataAgend.toDateString() === hoje && a.status !== 'Cancelado';
      }).sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora));
      
      const proximosAgendamentos = allAgendamentos.filter(a => {
        const dataAgend = new Date(a.data_hora);
        return dataAgend > now && a.status !== 'Cancelado';
      }).sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora)).slice(0, 10);
      
      const pendentesConfirmacao = allAgendamentos.filter(a => 
        a.status === 'Pendente' && new Date(a.data_hora) > now
      ).length;
      
      const confirmadosHoje = agendamentosHoje.filter(a => a.status === 'Confirmado').length;
      
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="space-y-6">
          <!-- Cards de Resumo -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Agendamentos Hoje</p>
                  <p class="text-3xl font-bold text-blue-600 mt-2">${agendamentosHoje.length}</p>
                  <p class="text-xs text-gray-400 mt-1">${confirmadosHoje} confirmados</p>
                </div>
                <div class="bg-blue-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Próximos Agendamentos</p>
                  <p class="text-3xl font-bold text-green-600 mt-2">${proximosAgendamentos.length}</p>
                  <p class="text-xs text-gray-400 mt-1">nos próximos dias</p>
                </div>
                <div class="bg-green-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-yellow-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Pendentes Confirmação</p>
                  <p class="text-3xl font-bold text-yellow-600 mt-2">${pendentesConfirmacao}</p>
                  <p class="text-xs text-gray-400 mt-1">aguardando confirmação</p>
                </div>
                <div class="bg-yellow-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500 text-sm font-medium">Total de Agendamentos</p>
                  <p class="text-3xl font-bold text-purple-600 mt-2">${allAgendamentos.length}</p>
                  <p class="text-xs text-gray-400 mt-1">no sistema</p>
                </div>
                <div class="bg-purple-100 p-3 rounded-full">
                  <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Abas -->
          <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="border-b border-gray-200">
              <nav class="flex -mb-px">
                <button onclick="trocarAbaAgenda('horarios')" 
                  id="aba-horarios"
                  class="aba-agenda px-6 py-4 text-sm font-medium border-b-2 border-blue-500 text-blue-600">
                  Horários Disponíveis
                </button>
                <button onclick="trocarAbaAgenda('agendamentos')" 
                  id="aba-agendamentos"
                  class="aba-agenda px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                  Todos os Agendamentos
                </button>
                <button onclick="trocarAbaAgenda('confirmacoes')" 
                  id="aba-confirmacoes"
                  class="aba-agenda px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                  Confirmações
                </button>
              </nav>
            </div>

            <div id="conteudo-aba-agenda" class="p-6"></div>
          </div>
        </div>
      `;

      trocarAbaAgenda('horarios');
    }

    let abaAgendaAtual = 'horarios';

    function trocarAbaAgenda(aba) {
      abaAgendaAtual = aba;
      
      document.querySelectorAll('.aba-agenda').forEach(btn => {
        btn.classList.remove('border-blue-500', 'border-green-500', 'border-yellow-500', 'text-blue-600', 'text-green-600', 'text-yellow-600');
        btn.classList.add('border-transparent', 'text-gray-500');
      });
      
      const btnAtivo = document.getElementById(`aba-${aba}`);
      if (btnAtivo) {
        btnAtivo.classList.remove('border-transparent', 'text-gray-500');
        if (aba === 'horarios') {
          btnAtivo.classList.add('border-blue-500', 'text-blue-600');
        } else if (aba === 'agendamentos') {
          btnAtivo.classList.add('border-green-500', 'text-green-600');
        } else if (aba === 'confirmacoes') {
          btnAtivo.classList.add('border-yellow-500', 'text-yellow-600');
        }
      }
      
      switch(aba) {
        case 'horarios':
          renderHorariosDisponiveis();
          break;
        case 'agendamentos':
          renderTodosAgendamentos();
          break;
        case 'confirmacoes':
          renderConfirmacoes();
          break;
      }
    }

    function renderHorariosDisponiveis() {
      const conteudo = document.getElementById('conteudo-aba-agenda');
      conteudo.innerHTML = `
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-800">Gerenciar Horários Disponíveis</h3>
            <button onclick="abrirModalNovoAgendamento()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Novo Agendamento
            </button>
          </div>

          <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-blue-700">
                  <strong>Dica:</strong> Configure seus horários de atendimento e organize sua agenda de forma eficiente. 
                  Você pode visualizar agendamentos por dia, semana ou mês.
                </p>
              </div>
            </div>
          </div>

          <!-- Calendário Simplificado -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Agendamentos de Hoje -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 border-2 border-blue-200">
              <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                Hoje - ${new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}
              </h4>
              
              ${(() => {
                const hoje = new Date().toDateString();
                const agendHoje = allAgendamentos.filter(a => {
                  const dataAgend = new Date(a.data_hora);
                  return dataAgend.toDateString() === hoje && a.status !== 'Cancelado';
                }).sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora));

                if (agendHoje.length === 0) {
                  return `
                    <div class="text-center py-8">
                      <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      <p class="text-gray-500">Nenhum agendamento hoje</p>
                    </div>
                  `;
                }

                return `
                  <div class="space-y-3 max-h-96 overflow-y-auto">
                    ${agendHoje.map(agend => `
                      <div class="bg-white rounded-lg p-4 shadow hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-2">
                          <div class="flex-1">
                            <p class="font-bold text-gray-800">${agend.cliente}</p>
                            <p class="text-sm text-gray-600">${agend.servico}</p>
                          </div>
                          <span class="inline-block px-2 py-1 text-xs font-semibold rounded ${
                            agend.status === 'Confirmado' ? 'bg-green-100 text-green-800' :
                            agend.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }">${agend.status}</span>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-gray-500">
                          <span class="flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            ${new Date(agend.data_hora).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                          </span>
                          ${agend.duracao ? `
                            <span class="flex items-center gap-1">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                              </svg>
                              ${agend.duracao} min
                            </span>
                          ` : ''}
                        </div>
                        <div class="mt-3 flex gap-2">
                          <button onclick='verAgendamento(${JSON.stringify(agend)})' class="flex-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm font-medium">
                            Ver Detalhes
                          </button>
                          ${agend.status === 'Pendente' ? `
                            <button onclick='confirmarAgendamento(${JSON.stringify(agend)})' class="flex-1 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm font-medium">
                              Confirmar
                            </button>
                          ` : ''}
                        </div>
                      </div>
                    `).join('')}
                  </div>
                `;
              })()}
            </div>

            <!-- Próximos Agendamentos -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border-2 border-green-200">
              <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                Próximos Agendamentos
              </h4>
              
              ${(() => {
                const now = new Date();
                const proximos = allAgendamentos.filter(a => {
                  const dataAgend = new Date(a.data_hora);
                  return dataAgend > now && dataAgend.toDateString() !== now.toDateString() && a.status !== 'Cancelado';
                }).sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora)).slice(0, 10);

                if (proximos.length === 0) {
                  return `
                    <div class="text-center py-8">
                      <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      <p class="text-gray-500">Nenhum agendamento próximo</p>
                    </div>
                  `;
                }

                return `
                  <div class="space-y-3 max-h-96 overflow-y-auto">
                    ${proximos.map(agend => `
                      <div class="bg-white rounded-lg p-4 shadow hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-2">
                          <div class="flex-1">
                            <p class="font-bold text-gray-800">${agend.cliente}</p>
                            <p class="text-sm text-gray-600">${agend.servico}</p>
                          </div>
                          <span class="inline-block px-2 py-1 text-xs font-semibold rounded ${
                            agend.status === 'Confirmado' ? 'bg-green-100 text-green-800' :
                            agend.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }">${agend.status}</span>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-gray-500">
                          <span class="flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            ${formatDate(agend.data_hora)}
                          </span>
                          <span class="flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            ${new Date(agend.data_hora).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                          </span>
                        </div>
                        <div class="mt-3 flex gap-2">
                          <button onclick='verAgendamento(${JSON.stringify(agend)})' class="flex-1 px-3 py-1.5 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm font-medium">
                            Ver Detalhes
                          </button>
                          ${agend.status === 'Pendente' ? `
                            <button onclick='confirmarAgendamento(${JSON.stringify(agend)})' class="flex-1 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm font-medium">
                              Confirmar
                            </button>
                          ` : ''}
                        </div>
                      </div>
                    `).join('')}
                  </div>
                `;
              })()}
            </div>
          </div>
        </div>
      `;
    }

    function renderTodosAgendamentos() {
      const conteudo = document.getElementById('conteudo-aba-agenda');
      
      const agendamentos = [...allAgendamentos].sort((a, b) => new Date(b.data_hora) - new Date(a.data_hora));
      
      conteudo.innerHTML = `
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-800">Todos os Agendamentos</h3>
            <button onclick="abrirModalNovoAgendamento()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Novo Agendamento
            </button>
          </div>

          ${agendamentos.length > 0 ? `
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serviço</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data/Hora</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duração</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  ${agendamentos.map(agend => `
                    <tr class="table-row-hover">
                      <td class="px-4 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div class="flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold">
                            ${agend.cliente.charAt(0).toUpperCase()}
                          </div>
                          <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">${agend.cliente}</p>
                            ${agend.telefone ? `<p class="text-xs text-gray-500">${agend.telefone}</p>` : ''}
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-4 text-sm text-gray-900">${agend.servico}</td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="flex flex-col">
                          <span class="font-medium">${formatDate(agend.data_hora)}</span>
                          <span class="text-xs text-gray-500">${new Date(agend.data_hora).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</span>
                        </div>
                      </td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${agend.duracao ? agend.duracao + ' min' : '-'}</td>
                      <td class="px-4 py-4 whitespace-nowrap">
                        <select onchange='alterarStatusAgendamento(${JSON.stringify(agend)}, this.value)' 
                          class="status-badge px-2 py-1 text-xs font-semibold rounded-full border-none cursor-pointer ${
                            agend.status === 'Confirmado' ? 'bg-green-100 text-green-800' :
                            agend.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                            agend.status === 'Concluído' ? 'bg-blue-100 text-blue-800' :
                            'bg-red-100 text-red-800'
                          }">
                          <option value="Pendente" ${agend.status === 'Pendente' ? 'selected' : ''}>PENDENTE</option>
                          <option value="Confirmado" ${agend.status === 'Confirmado' ? 'selected' : ''}>CONFIRMADO</option>
                          <option value="Concluído" ${agend.status === 'Concluído' ? 'selected' : ''}>CONCLUÍDO</option>
                          <option value="Cancelado" ${agend.status === 'Cancelado' ? 'selected' : ''}>CANCELADO</option>
                        </select>
                      </td>
                      <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick='verAgendamento(${JSON.stringify(agend)})' class="text-blue-600 hover:text-blue-900 mr-3">Ver</button>
                        <button onclick='editarAgendamento(${JSON.stringify(agend)})' class="text-green-600 hover:text-green-900 mr-3">Editar</button>
                        <button onclick='excluirAgendamento(${JSON.stringify(agend)})' class="text-red-600 hover:text-red-900">Excluir</button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          ` : `
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Nenhum agendamento</h3>
              <p class="mt-1 text-sm text-gray-500">Comece criando um novo agendamento.</p>
            </div>
          `}
        </div>
      `;
    }

    function renderConfirmacoes() {
      const conteudo = document.getElementById('conteudo-aba-agenda');
      
      const now = new Date();
      const pendentes = allAgendamentos.filter(a => 
        a.status === 'Pendente' && new Date(a.data_hora) > now
      ).sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora));
      
      conteudo.innerHTML = `
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold text-gray-800">Agendamentos Pendentes de Confirmação</h3>
          </div>

          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-700">
                  <strong>Atenção:</strong> Você tem ${pendentes.length} agendamento(s) pendente(s) de confirmação. 
                  Confirme ou cancele para organizar sua agenda.
                </p>
              </div>
            </div>
          </div>

          ${pendentes.length > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              ${pendentes.map(agend => `
                <div class="bg-white border-2 border-yellow-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center gap-3">
                      <div class="flex-shrink-0 h-12 w-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                        ${agend.cliente.charAt(0).toUpperCase()}
                      </div>
                      <div>
                        <h4 class="font-bold text-gray-800">${agend.cliente}</h4>
                        ${agend.telefone ? `<p class="text-xs text-gray-500">${agend.telefone}</p>` : ''}
                      </div>
                    </div>
                  </div>
                  
                  <div class="bg-yellow-50 rounded-lg p-3 mb-3">
                    <p class="text-sm font-semibold text-gray-800 mb-1">${agend.servico}</p>
                    <div class="flex items-center gap-3 text-xs text-gray-600">
                      <span class="flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        ${formatDate(agend.data_hora)}
                      </span>
                      <span class="flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        ${new Date(agend.data_hora).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                      </span>
                    </div>
                    ${agend.duracao ? `<p class="text-xs text-gray-500 mt-1">Duração: ${agend.duracao} minutos</p>` : ''}
                  </div>

                  ${agend.notas ? `
                    <div class="mb-3">
                      <p class="text-xs text-gray-500 mb-1">Notas:</p>
                      <p class="text-sm text-gray-700 bg-gray-50 rounded p-2">${agend.notas}</p>
                    </div>
                  ` : ''}

                  <div class="flex gap-2">
                    <button onclick='confirmarAgendamento(${JSON.stringify(agend)})' 
                      class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold flex items-center justify-center gap-2">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                      </svg>
                      Confirmar
                    </button>
                    <button onclick='cancelarAgendamento(${JSON.stringify(agend)})' 
                      class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-semibold">
                      Cancelar
                    </button>
                  </div>

                  <button onclick='verAgendamento(${JSON.stringify(agend)})' 
                    class="w-full mt-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium">
                    Ver Detalhes Completos
                  </button>
                </div>
              `).join('')}
            </div>
          ` : `
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Tudo confirmado!</h3>
              <p class="mt-1 text-sm text-gray-500">Não há agendamentos pendentes de confirmação.</p>
            </div>
          `}
        </div>
      `;
    }

    function abrirModalNovoAgendamento() {
      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Novo Agendamento</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-novo-agendamento" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="agend-cliente" class="block text-sm font-medium text-gray-700 mb-2">
                  Nome do Cliente *
                </label>
                <input type="text" id="agend-cliente" required
                  placeholder="Nome completo"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label for="agend-telefone" class="block text-sm font-medium text-gray-700 mb-2">
                  Telefone/WhatsApp *
                </label>
                <input type="tel" id="agend-telefone" required
                  placeholder="(00) 00000-0000"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="agend-servico" class="block text-sm font-medium text-gray-700 mb-2">
                Serviço *
              </label>
              <input type="text" id="agend-servico" required
                placeholder="Ex: Corte de cabelo, Aula de violão, Sessão de fotos, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="agend-data" class="block text-sm font-medium text-gray-700 mb-2">
                  Data *
                </label>
                <input type="date" id="agend-data" required
                  min="${new Date().toISOString().split('T')[0]}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label for="agend-hora" class="block text-sm font-medium text-gray-700 mb-2">
                  Horário *
                </label>
                <input type="time" id="agend-hora" required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="agend-duracao" class="block text-sm font-medium text-gray-700 mb-2">
                Duração (em minutos)
              </label>
              <input type="number" id="agend-duracao" min="15" step="15"
                placeholder="Ex: 30, 60, 90..."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="agend-notas" class="block text-sm font-medium text-gray-700 mb-2">
                Notas do Serviço
              </label>
              <textarea id="agend-notas" rows="3"
                placeholder="Observações, preferências do cliente, materiais necessários, etc."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
            </div>

            <div>
              <label for="agend-status" class="block text-sm font-medium text-gray-700 mb-2">
                Status *
              </label>
              <select id="agend-status" required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="Pendente">Pendente (aguardando confirmação)</option>
                <option value="Confirmado">Confirmado</option>
              </select>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                Criar Agendamento
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação telefone
      const telefoneInput = document.getElementById('agend-telefone');
      if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 11) value = value.slice(0, 11);
          
          if (value.length >= 11) {
            value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
          } else if (value.length >= 10) {
            value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
          } else if (value.length >= 6) {
            value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
          } else if (value.length >= 2) {
            value = value.replace(/^(\d{2})(\d{0,4})$/, '($1) $2');
          }
          
          e.target.value = value;
        });
      }

      document.getElementById('form-novo-agendamento').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (allAgendamentos.length >= 999) {
          showToast('Limite máximo de 999 agendamentos atingido. Delete alguns agendamentos primeiro.', 'error');
          return;
        }

        const data = document.getElementById('agend-data').value;
        const hora = document.getElementById('agend-hora').value;
        const dataHora = `${data}T${hora}:00`;

        const novoAgendamento = {
          tipo: 'agendamento',
          cliente: document.getElementById('agend-cliente').value,
          telefone: document.getElementById('agend-telefone').value,
          servico: document.getElementById('agend-servico').value,
          data_hora: dataHora,
          duracao: parseInt(document.getElementById('agend-duracao').value) || 0,
          notas: document.getElementById('agend-notas').value || '',
          status: document.getElementById('agend-status').value
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(novoAgendamento);
          
          if (result.isOk) {
            showToast('Agendamento criado com sucesso!', 'success');
            closeModal();
          } else {
            showToast('Erro ao criar agendamento: ' + result.error.message, 'error');
          }
        }
      });
    }

    function verAgendamento(agend) {
      showModal(`
        <div class="p-6 max-h-[90vh] overflow-y-auto">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Detalhes do Agendamento</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <div class="space-y-4">
            <!-- Status Badge -->
            <div class="flex justify-center">
              <span class="inline-block px-6 py-2 text-sm font-bold rounded-full ${
                agend.status === 'Confirmado' ? 'bg-green-100 text-green-800' :
                agend.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                agend.status === 'Concluído' ? 'bg-blue-100 text-blue-800' :
                'bg-red-100 text-red-800'
              }">
                ${agend.status.toUpperCase()}
              </span>
            </div>

            <!-- Cliente -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border-2 border-blue-200">
              <h4 class="text-sm font-bold text-gray-600 mb-3 uppercase">Cliente</h4>
              <div class="flex items-center gap-4 mb-3">
                <div class="flex-shrink-0 h-16 w-16 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold text-2xl">
                  ${agend.cliente.charAt(0).toUpperCase()}
                </div>
                <div>
                  <p class="text-lg font-bold text-gray-800">${agend.cliente}</p>
                  ${agend.telefone ? `
                    <a href="https://wa.me/${agend.telefone.replace(/\D/g, '')}" target="_blank" rel="noopener noreferrer"
                      class="text-sm text-green-600 hover:text-green-700 flex items-center gap-1 mt-1">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                      </svg>
                      ${agend.telefone}
                    </a>
                  ` : ''}
                </div>
              </div>
            </div>

            <!-- Serviço -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4 border-2 border-green-200">
              <h4 class="text-sm font-bold text-gray-600 mb-2 uppercase">Serviço</h4>
              <p class="text-lg font-bold text-gray-800">${agend.servico}</p>
            </div>

            <!-- Data e Hora -->
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-4 border-2 border-purple-200">
                <h4 class="text-sm font-bold text-gray-600 mb-2 uppercase">Data</h4>
                <p class="text-lg font-bold text-gray-800">${formatDate(agend.data_hora)}</p>
                <p class="text-xs text-gray-500 mt-1">${new Date(agend.data_hora).toLocaleDateString('pt-BR', { weekday: 'long' })}</p>
              </div>

              <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-4 border-2 border-orange-200">
                <h4 class="text-sm font-bold text-gray-600 mb-2 uppercase">Horário</h4>
                <p class="text-lg font-bold text-gray-800">${new Date(agend.data_hora).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</p>
                ${agend.duracao ? `<p class="text-xs text-gray-500 mt-1">${agend.duracao} minutos</p>` : ''}
              </div>
            </div>

            <!-- Notas -->
            ${agend.notas ? `
              <div class="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                <h4 class="text-sm font-bold text-gray-600 mb-2 uppercase">Notas do Serviço</h4>
                <p class="text-sm text-gray-700 whitespace-pre-wrap">${agend.notas}</p>
              </div>
            ` : ''}

            <!-- Ações -->
            <div class="flex flex-col gap-3 pt-4">
              ${agend.status === 'Pendente' ? `
                <button onclick='confirmarAgendamento(${JSON.stringify(agend)})' 
                  class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-bold flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  Confirmar Agendamento
                </button>
              ` : ''}
              
              ${agend.status === 'Confirmado' ? `
                <button onclick='concluirAgendamento(${JSON.stringify(agend)})' 
                  class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-bold flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  Marcar como Concluído
                </button>
              ` : ''}

              <div class="flex gap-3">
                <button onclick='editarAgendamento(${JSON.stringify(agend)})' 
                  class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-semibold">
                  Editar
                </button>
                ${agend.status !== 'Cancelado' ? `
                  <button onclick='cancelarAgendamento(${JSON.stringify(agend)})' 
                    class="flex-1 px-6 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-semibold">
                    Cancelar
                  </button>
                ` : ''}
              </div>

              <button onclick="closeModal()" 
                class="w-full px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Fechar
              </button>
            </div>
          </div>
        </div>
      `);
    }

    function editarAgendamento(agend) {
      const dataHora = new Date(agend.data_hora);
      const data = dataHora.toISOString().split('T')[0];
      const hora = dataHora.toTimeString().slice(0, 5);

      showModal(`
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800">Editar Agendamento</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <form id="form-editar-agendamento" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="edit-agend-cliente" class="block text-sm font-medium text-gray-700 mb-2">
                  Nome do Cliente *
                </label>
                <input type="text" id="edit-agend-cliente" required value="${agend.cliente}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label for="edit-agend-telefone" class="block text-sm font-medium text-gray-700 mb-2">
                  Telefone/WhatsApp *
                </label>
                <input type="tel" id="edit-agend-telefone" required value="${agend.telefone || ''}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="edit-agend-servico" class="block text-sm font-medium text-gray-700 mb-2">
                Serviço *
              </label>
              <input type="text" id="edit-agend-servico" required value="${agend.servico}"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="edit-agend-data" class="block text-sm font-medium text-gray-700 mb-2">
                  Data *
                </label>
                <input type="date" id="edit-agend-data" required value="${data}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label for="edit-agend-hora" class="block text-sm font-medium text-gray-700 mb-2">
                  Horário *
                </label>
                <input type="time" id="edit-agend-hora" required value="${hora}"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>

            <div>
              <label for="edit-agend-duracao" class="block text-sm font-medium text-gray-700 mb-2">
                Duração (em minutos)
              </label>
              <input type="number" id="edit-agend-duracao" min="15" step="15" value="${agend.duracao || ''}"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div>
              <label for="edit-agend-notas" class="block text-sm font-medium text-gray-700 mb-2">
                Notas do Serviço
              </label>
              <textarea id="edit-agend-notas" rows="3"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none">${agend.notas || ''}</textarea>
            </div>

            <div>
              <label for="edit-agend-status" class="block text-sm font-medium text-gray-700 mb-2">
                Status *
              </label>
              <select id="edit-agend-status" required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="Pendente" ${agend.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                <option value="Confirmado" ${agend.status === 'Confirmado' ? 'selected' : ''}>Confirmado</option>
                <option value="Concluído" ${agend.status === 'Concluído' ? 'selected' : ''}>Concluído</option>
                <option value="Cancelado" ${agend.status === 'Cancelado' ? 'selected' : ''}>Cancelado</option>
              </select>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="closeModal()" 
                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                Salvar Alterações
              </button>
            </div>
          </form>
        </div>
      `);

      // Formatação telefone
      const telefoneInput = document.getElementById('edit-agend-telefone');
      if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 11) value = value.slice(0, 11);
          
          if (value.length >= 11) {
            value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
          } else if (value.length >= 10) {
            value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
          } else if (value.length >= 6) {
            value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
          } else if (value.length >= 2) {
            value = value.replace(/^(\d{2})(\d{0,4})$/, '($1) $2');
          }
          
          e.target.value = value;
        });
      }

      document.getElementById('form-editar-agendamento').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const data = document.getElementById('edit-agend-data').value;
        const hora = document.getElementById('edit-agend-hora').value;
        const dataHora = `${data}T${hora}:00`;

        const agendAtualizado = {
          ...agend,
          cliente: document.getElementById('edit-agend-cliente').value,
          telefone: document.getElementById('edit-agend-telefone').value,
          servico: document.getElementById('edit-agend-servico').value,
          data_hora: dataHora,
          duracao: parseInt(document.getElementById('edit-agend-duracao').value) || 0,
          notas: document.getElementById('edit-agend-notas').value || '',
          status: document.getElementById('edit-agend-status').value
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.update(agendAtualizado);
          
          if (result.isOk) {
            showToast('Agendamento atualizado com sucesso!', 'success');
            closeModal();
          } else {
            showToast('Erro ao atualizar agendamento: ' + result.error.message, 'error');
          }
        }
      });
    }

    async function confirmarAgendamento(agend) {
      if (!window.dataSdk) return;
      
      const agendAtualizado = {
        ...agend,
        status: 'Confirmado'
      };
      
      const result = await window.dataSdk.update(agendAtualizado);
      
      if (result.isOk) {
        showToast('Agendamento confirmado!', 'success');
        closeModal();
      } else {
        showToast('Erro ao confirmar agendamento', 'error');
      }
    }

    async function concluirAgendamento(agend) {
      if (!window.dataSdk) return;
      
      const agendAtualizado = {
        ...agend,
        status: 'Concluído'
      };
      
      const result = await window.dataSdk.update(agendAtualizado);
      
      if (result.isOk) {
        showToast('Agendamento marcado como concluído!', 'success');
        closeModal();
      } else {
        showToast('Erro ao atualizar agendamento', 'error');
      }
    }

    async function cancelarAgendamento(agend) {
      if (!window.dataSdk) return;
      
      const agendAtualizado = {
        ...agend,
        status: 'Cancelado'
      };
      
      const result = await window.dataSdk.update(agendAtualizado);
      
      if (result.isOk) {
        showToast('Agendamento cancelado', 'info');
        closeModal();
      } else {
        showToast('Erro ao cancelar agendamento', 'error');
      }
    }

    async function alterarStatusAgendamento(agend, novoStatus) {
      if (!window.dataSdk) return;
      
      const agendAtualizado = {
        ...agend,
        status: novoStatus
      };
      
      const result = await window.dataSdk.update(agendAtualizado);
      
      if (result.isOk) {
        showToast(`Status alterado para ${novoStatus}`, 'success');
      } else {
        showToast('Erro ao alterar status', 'error');
      }
    }

    async function excluirAgendamento(agend) {
      if (!window.dataSdk) return;
      
      const result = await window.dataSdk.delete(agend);
      
      if (result.isOk) {
        showToast('Agendamento excluído com sucesso', 'success');
      } else {
        showToast('Erro ao excluir agendamento', 'error');
      }
    }
    
    function renderRelatorios() {
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800">Relatórios</h2>
          </div>
          
          <div class="p-6">
            <p class="text-gray-600">Módulo de relatórios em desenvolvimento.</p>
          </div>
        </div>
      `;
    }

    function renderConfiguracoes() {
      const config = window.elementSdk?.config || defaultConfig;
      
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="max-w-5xl mx-auto space-y-6">
          <!-- Header -->
          <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-lg p-8 text-white">
            <div class="flex items-center gap-4">
              <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                </svg>
              </div>
              <div>
                <h1 class="text-3xl font-bold">Informações da Empresa</h1>
                <p class="text-blue-100 mt-1">Configure os dados da sua empresa</p>
              </div>
            </div>
          </div>

          <form id="form-config" class="space-y-6">
            <!-- Logo da Empresa -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
              <div class="bg-gradient-to-r from-purple-50 to-pink-50 px-6 py-4 border-b border-purple-100">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                  <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  Logo da Empresa
                </h3>
              </div>
              <div class="p-6">
                <div class="flex flex-col items-center gap-4">
                  <div id="logo-preview" class="w-48 h-48 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center border-4 border-dashed border-gray-300 overflow-hidden">
                    ${config.empresa_logo ? `
                      <img src="${config.empresa_logo}" alt="Logo" class="w-full h-full object-contain">
                    ` : `
                      <div class="text-center">
                        <svg class="w-16 h-16 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-sm text-gray-500">Nenhuma logo</p>
                      </div>
                    `}
                  </div>
                  <div class="flex gap-3">
                    <label class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors cursor-pointer flex items-center gap-2">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                      </svg>
                      Upload Logo
                      <input type="file" id="logo-input" accept="image/*" class="hidden">
                    </label>
                    ${config.empresa_logo ? `
                      <button type="button" onclick="removerLogo()" class="px-6 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Remover
                      </button>
                    ` : ''}
                  </div>
                  <p class="text-xs text-gray-500 text-center">Formatos aceitos: PNG, JPG, GIF (máx. 5MB)<br>Recomendado: 500x500 pixels</p>
                </div>
              </div>
            </div>

            <!-- Dados Básicos -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
              <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-blue-100">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                  <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  Dados Básicos
                </h3>
              </div>
              <div class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label for="config-nome" class="block text-sm font-medium text-gray-700 mb-2">
                      Nome da Empresa *
                    </label>
                    <input type="text" id="config-nome" required value="${config.empresa_nome || ''}"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label for="config-slogan" class="block text-sm font-medium text-gray-700 mb-2">
                      Slogan
                    </label>
                    <input type="text" id="config-slogan" value="${config.empresa_slogan || ''}"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label for="config-cnpj" class="block text-sm font-medium text-gray-700 mb-2">
                      CNPJ
                    </label>
                    <input type="text" id="config-cnpj" value="${config.empresa_cnpj || ''}"
                      placeholder="00.000.000/0000-00" maxlength="18"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label for="config-cnae" class="block text-sm font-medium text-gray-700 mb-2">
                      CNAE
                      <a href="https://cnae.ibge.gov.br/" target="_blank" rel="noopener noreferrer" 
                        class="ml-2 text-blue-600 hover:text-blue-700 text-xs">
                        (Consultar CNAE →)
                      </a>
                    </label>
                    <input type="text" id="config-cnae" value="${config.empresa_cnae || ''}"
                      placeholder="0000-0/00"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                  </div>
                </div>
              </div>
            </div>

            <!-- Endereço -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
              <div class="bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 border-b border-green-100">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                  <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  Endereço
                </h3>
              </div>
              <div class="p-6">
                <div>
                  <label for="config-endereco" class="block text-sm font-medium text-gray-700 mb-2">
                    Endereço Completo
                  </label>
                  <textarea id="config-endereco" rows="3"
                    placeholder="Rua, número, complemento, bairro, cidade - estado, CEP"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all resize-none">${config.empresa_endereco || ''}</textarea>
                </div>
              </div>
            </div>

            <!-- Contato -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
              <div class="bg-gradient-to-r from-orange-50 to-amber-50 px-6 py-4 border-b border-orange-100">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                  <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                  </svg>
                  Informações de Contato
                </h3>
              </div>
              <div class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label for="config-telefone" class="block text-sm font-medium text-gray-700 mb-2">
                      Telefone
                    </label>
                    <input type="tel" id="config-telefone" value="${config.empresa_telefone || ''}"
                      placeholder="(00) 0000-0000"
                      maxlength="15"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label for="config-email" class="block text-sm font-medium text-gray-700 mb-2">
                      Email
                    </label>
                    <input type="email" id="config-email" value="${config.empresa_email || ''}"
                      placeholder="contato@empresa.com.br"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all">
                  </div>
                </div>

                <div>
                  <label for="config-site" class="block text-sm font-medium text-gray-700 mb-2">
                    Website
                  </label>
                  <input type="text" id="config-site" value="${config.empresa_site || ''}"
                    placeholder="www.empresa.com.br ou https://www.empresa.com.br"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all">
                </div>
              </div>
            </div>

            <!-- Botões de Ação -->
            <div class="bg-white rounded-lg shadow-lg p-6">
              <div class="flex flex-col sm:flex-row gap-3 justify-end">
                <button type="button" onclick="navigate('dashboard')" 
                  class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                  Cancelar
                </button>
                <button type="submit" 
                  class="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all font-bold flex items-center justify-center gap-2 shadow-lg">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  Salvar Informações
                </button>
              </div>
            </div>
          </form>
        </div>
      `;

      // Formatar CNPJ
      const cnpjInput = document.getElementById('config-cnpj');
      if (cnpjInput) {
        cnpjInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 14) value = value.slice(0, 14);
          
          if (value.length >= 12) {
            value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/, '$1.$2.$3/$4-$5');
          } else if (value.length >= 8) {
            value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{0,4})$/, '$1.$2.$3/$4');
          } else if (value.length >= 5) {
            value = value.replace(/^(\d{2})(\d{3})(\d{0,3})$/, '$1.$2.$3');
          } else if (value.length >= 2) {
            value = value.replace(/^(\d{2})(\d{0,3})$/, '$1.$2');
          }
          
          e.target.value = value;
        });
      }

      // Formatar Telefone
      const telefoneInput = document.getElementById('config-telefone');
      if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 11) value = value.slice(0, 11);
          
          if (value.length >= 11) {
            // Celular: (00) 00000-0000
            value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
          } else if (value.length >= 10) {
            // Fixo: (00) 0000-0000
            value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
          } else if (value.length >= 6) {
            value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
          } else if (value.length >= 2) {
            value = value.replace(/^(\d{2})(\d{0,4})$/, '($1) $2');
          }
          
          e.target.value = value;
        });
      }

      // Upload de logo
      const logoInput = document.getElementById('logo-input');
      if (logoInput) {
        logoInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (!file) return;
          
          if (file.size > 5 * 1024 * 1024) {
            showToast('Arquivo muito grande. Máximo 5MB', 'error');
            return;
          }
          
          if (!file.type.startsWith('image/')) {
            showToast('Por favor, selecione uma imagem', 'error');
            return;
          }
          
          const reader = new FileReader();
          reader.onload = function(event) {
            const logoPreview = document.getElementById('logo-preview');
            logoPreview.innerHTML = `<img src="${event.target.result}" alt="Logo" class="w-full h-full object-contain">`;
            window.tempLogoData = event.target.result;
          };
          reader.readAsDataURL(file);
        });
      }

      // Submit do formulário
      document.getElementById('form-config').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const configData = {
          empresa_nome: document.getElementById('config-nome').value,
          empresa_slogan: document.getElementById('config-slogan').value,
          empresa_cnpj: document.getElementById('config-cnpj').value,
          empresa_cnae: document.getElementById('config-cnae').value,
          empresa_endereco: document.getElementById('config-endereco').value,
          empresa_telefone: document.getElementById('config-telefone').value,
          empresa_email: document.getElementById('config-email').value,
          empresa_site: document.getElementById('config-site').value
        };

        if (window.tempLogoData) {
          configData.empresa_logo = window.tempLogoData;
        } else if (config.empresa_logo) {
          configData.empresa_logo = config.empresa_logo;
        }

        if (window.elementSdk) {
          await window.elementSdk.setConfig(configData);
        }

        showToast('Informações da empresa salvas com sucesso!', 'success');
        navigate('dashboard');
      });
    }

    function removerLogo() {
      const logoPreview = document.getElementById('logo-preview');
      logoPreview.innerHTML = `
        <div class="text-center">
          <svg class="w-16 h-16 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <p class="text-sm text-gray-500">Nenhuma logo</p>
        </div>
      `;
      window.tempLogoData = null;
      
      if (window.elementSdk) {
        const config = window.elementSdk.config;
        window.elementSdk.setConfig({
          ...config,
          empresa_logo: ''
        });
      }
      
      showToast('Logo removida', 'info');
      renderConfiguracoes();
    }
    
    function renderConfigAvancadas() {
      const content = document.getElementById('main-content');
      content.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800">Configurações Avan��adas</h2>
          </div>
          
          <div class="p-6">
            <p class="text-gray-600">Configurações avançadas em desenvolvimento.</p>
          </div>
        </div>
      `;
    }

    function verPedido(pedido) {
      const config = window.elementSdk?.config || defaultConfig;
      const cliente = pedido.clienteId !== 'novo' 
        ? CLIENTES.find(c => c.id === pedido.clienteId)
        : { nome: pedido.cliente, email: '', telefone: '', endereco: '' };
      
      const produtos = JSON.parse(pedido.produtos);
      
      showModal(`
        <div class="flex flex-col h-full max-h-[90vh]">
          <!-- Header do Modal -->
          <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-800">Visualizar Pedido</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <!-- Botões de Ação -->
          <div class="p-4 border-b border-gray-200 bg-gray-50 flex flex-wrap gap-3">
            <button onclick="imprimirPedido()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-semibold">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
              </svg>
              Imprimir
            </button>
            <button onclick="compartilharPedido()" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 font-semibold">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
              </svg>
              Compartilhar
            </button>
            <button onclick="baixarPDF()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 font-semibold">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Baixar PDF
            </button>
          </div>

          <!-- Área do PDF (A4) -->
          <div class="flex-1 overflow-y-auto p-6 bg-gray-100">
            <div id="pedido-pdf-content" class="max-w-[210mm] mx-auto bg-white shadow-lg" style="min-height: 297mm; padding: 20mm;">
              <!-- Cabeçalho da Empresa -->
              <div class="flex items-start justify-between mb-8 pb-6 border-b-2 border-gray-300">
                <div class="flex-1">
                  ${config.empresa_logo ? `
                    <img src="${config.empresa_logo}" alt="Logo" class="h-16 mb-3 object-contain" style="max-width: 150px;">
                  ` : ''}
                  <h1 class="text-2xl font-bold text-gray-800 mb-1">${config.empresa_nome || 'Minha Empresa'}</h1>
                  ${config.empresa_slogan ? `<p class="text-sm text-gray-600 mb-2">${config.empresa_slogan}</p>` : ''}
                  ${config.empresa_cnpj ? `<p class="text-xs text-gray-500">CNPJ: ${config.empresa_cnpj}</p>` : ''}
                  ${config.empresa_endereco ? `<p class="text-xs text-gray-500">${config.empresa_endereco}</p>` : ''}
                  <div class="flex gap-4 mt-2">
                    ${config.empresa_telefone ? `<p class="text-xs text-gray-500">Tel: ${config.empresa_telefone}</p>` : ''}
                    ${config.empresa_email ? `<p class="text-xs text-gray-500">${config.empresa_email}</p>` : ''}
                  </div>
                </div>
                <div class="text-right">
                  <div class="inline-block px-4 py-2 ${
                    pedido.status === 'Venda' ? 'bg-green-100 text-green-800' :
                    pedido.status === 'Orçamento' ? 'bg-blue-100 text-blue-800' :
                    pedido.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                  } rounded-lg font-bold text-lg mb-2">
                    ${pedido.status.toUpperCase()}
                  </div>
                  <p class="text-xs text-gray-500 mt-2">Data: ${formatDate(pedido.data)}</p>
                </div>
              </div>

              <!-- Informações do Cliente -->
              <div class="mb-8">
                <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                  Dados do Cliente
                </h2>
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <p class="text-xs text-gray-500 mb-1">Nome</p>
                      <p class="text-sm font-semibold text-gray-800">${cliente.nome}</p>
                    </div>
                    ${cliente.telefone ? `
                      <div>
                        <p class="text-xs text-gray-500 mb-1">Telefone</p>
                        <p class="text-sm font-semibold text-gray-800">${cliente.telefone}</p>
                      </div>
                    ` : ''}
                    ${cliente.email ? `
                      <div>
                        <p class="text-xs text-gray-500 mb-1">Email</p>
                        <p class="text-sm font-semibold text-gray-800">${cliente.email}</p>
                      </div>
                    ` : ''}
                    ${cliente.endereco ? `
                      <div class="col-span-2">
                        <p class="text-xs text-gray-500 mb-1">Endereço</p>
                        <p class="text-sm font-semibold text-gray-800">${cliente.endereco}</p>
                      </div>
                    ` : ''}
                  </div>
                </div>
              </div>

              <!-- Produtos -->
              <div class="mb-8">
                <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                  </svg>
                  Produtos
                </h2>
                <div class="border border-gray-300 rounded-lg overflow-hidden">
                  <table class="w-full text-sm">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 uppercase">Produto</th>
                        <th class="px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase">Qtd</th>
                        <th class="px-3 py-2 text-right text-xs font-semibold text-gray-700 uppercase">Valor Unit.</th>
                        <th class="px-3 py-2 text-right text-xs font-semibold text-gray-700 uppercase">Total</th>
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                      ${produtos.map(item => `
                        <tr>
                          <td class="px-3 py-2 text-gray-800">${item.nome}</td>
                          <td class="px-3 py-2 text-center text-gray-800">${item.quantidade}</td>
                          <td class="px-3 py-2 text-right text-gray-800">${formatCurrency(item.preco)}</td>
                          <td class="px-3 py-2 text-right font-semibold text-gray-800">${formatCurrency(item.preco * item.quantidade)}</td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Totais -->
              <div class="mb-8">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border-2 border-blue-200">
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-700">Subtotal:</span>
                      <span class="font-semibold text-gray-800">${formatCurrency(pedido.subtotal)}</span>
                    </div>
                    ${pedido.desconto > 0 ? `
                      <div class="flex justify-between text-sm">
                        <span class="text-gray-700">Desconto (${pedido.desconto}%):</span>
                        <span class="font-semibold text-red-600">- ${formatCurrency((pedido.subtotal * pedido.desconto) / 100)}</span>
                      </div>
                    ` : ''}
                    <div class="border-t-2 border-blue-300 pt-2 mt-2">
                      <div class="flex justify-between items-center">
                        <span class="text-lg font-bold text-gray-800">Total:</span>
                        <span class="text-2xl font-bold text-blue-600">${formatCurrency(pedido.total)}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Informações de Pagamento -->
              <div class="mb-8">
                <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                  </svg>
                  Pagamento
                </h2>
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <p class="text-xs text-gray-500 mb-1">Forma de Pagamento</p>
                      <p class="text-sm font-semibold text-gray-800">${pedido.formaPagamento}</p>
                    </div>
                    ${pedido.valorRecebido ? `
                      <div>
                        <p class="text-xs text-gray-500 mb-1">Valor Recebido</p>
                        <p class="text-sm font-semibold text-gray-800">${formatCurrency(pedido.valorRecebido)}</p>
                      </div>
                      <div>
                        <p class="text-xs text-gray-500 mb-1">Troco</p>
                        <p class="text-sm font-semibold text-green-600">${formatCurrency(pedido.troco)}</p>
                      </div>
                    ` : ''}
                    ${pedido.valorSinal ? `
                      <div>
                        <p class="text-xs text-gray-500 mb-1">Valor do Sinal</p>
                        <p class="text-sm font-semibold text-gray-800">${formatCurrency(pedido.valorSinal)}</p>
                      </div>
                      <div>
                        <p class="text-xs text-gray-500 mb-1">Valor Restante</p>
                        <p class="text-sm font-semibold text-orange-600">${formatCurrency(pedido.valorRestante)}</p>
                      </div>
                      ${pedido.formaPagamentoRestante ? `
                        <div>
                          <p class="text-xs text-gray-500 mb-1">Forma Pgto. Restante</p>
                          <p class="text-sm font-semibold text-gray-800">${pedido.formaPagamentoRestante}</p>
                        </div>
                      ` : ''}
                      ${pedido.dataProximoPagamento ? `
                        <div>
                          <p class="text-xs text-gray-500 mb-1">Data Próximo Pagamento</p>
                          <p class="text-sm font-semibold text-gray-800">${formatDate(pedido.dataProximoPagamento)}</p>
                        </div>
                      ` : ''}
                    ` : ''}
                  </div>
                </div>
              </div>

              <!-- Rodapé -->
              <div class="text-center text-xs text-gray-500 mt-8 pt-6 border-t border-gray-300">
                <p>Documento gerado em ${formatDateTime(new Date().toISOString())}</p>
                ${config.empresa_site ? `<p class="mt-1">${config.empresa_site}</p>` : ''}
              </div>
            </div>
          </div>
        </div>
      `);
      
      // Armazenar dados do pedido para uso nas funções
      window.currentPedidoData = { pedido, config, cliente, produtos };
    }

    function gerarPDFPedido() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const { pedido, config, cliente, produtos } = window.currentPedidoData;
      
      const pageWidth = 210;
      const pageHeight = 297;
      const margin = 20;
      const contentWidth = pageWidth - (margin * 2);
      let yPos = margin;
      
      // Logo da empresa (se existir)
      if (config.empresa_logo) {
        try {
          const img = new Image();
          img.src = config.empresa_logo;
          doc.addImage(img, 'PNG', margin, yPos, 40, 15);
          yPos += 18;
        } catch (e) {
          console.log('Erro ao adicionar logo:', e);
        }
      }
      
      // Cabeçalho da Empresa
      doc.setFontSize(18);
      doc.setFont(undefined, 'bold');
      doc.text(config.empresa_nome || 'Minha Empresa', margin, yPos);
      yPos += 7;
      
      if (config.empresa_slogan) {
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        doc.text(config.empresa_slogan, margin, yPos);
        yPos += 5;
      }
      
      doc.setFontSize(8);
      if (config.empresa_cnpj) {
        doc.text(`CNPJ: ${config.empresa_cnpj}`, margin, yPos);
        yPos += 4;
      }
      if (config.empresa_endereco) {
        const enderecoLinhas = doc.splitTextToSize(config.empresa_endereco, contentWidth * 0.7);
        doc.text(enderecoLinhas, margin, yPos);
        yPos += 4 * enderecoLinhas.length;
      }
      if (config.empresa_telefone || config.empresa_email) {
        let contato = '';
        if (config.empresa_telefone) contato += `Tel: ${config.empresa_telefone}`;
        if (config.empresa_email) contato += (contato ? '  |  ' : '') + config.empresa_email;
        doc.text(contato, margin, yPos);
        yPos += 4;
      }
      
      // Status e Data no topo direito
      const statusYStart = margin;
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.text(pedido.status.toUpperCase(), pageWidth - margin, statusYStart, { align: 'right' });
      doc.setFontSize(8);
      doc.setFont(undefined, 'normal');
      doc.text(`Data: ${formatDate(pedido.data)}`, pageWidth - margin, statusYStart + 7, { align: 'right' });
      
      yPos += 8;
      doc.setDrawColor(200, 200, 200);
      doc.setLineWidth(0.5);
      doc.line(margin, yPos, pageWidth - margin, yPos);
      yPos += 8;
      
      // Dados do Cliente
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.text('DADOS DO CLIENTE', margin, yPos);
      yPos += 7;
      
      doc.setFillColor(245, 247, 250);
      doc.rect(margin, yPos - 4, contentWidth, 25, 'F');
      
      doc.setFontSize(9);
      doc.setFont(undefined, 'bold');
      doc.text('Nome:', margin + 3, yPos);
      doc.setFont(undefined, 'normal');
      doc.text(cliente.nome, margin + 20, yPos);
      yPos += 5;
      
      if (cliente.telefone) {
        doc.setFont(undefined, 'bold');
        doc.text('Telefone:', margin + 3, yPos);
        doc.setFont(undefined, 'normal');
        doc.text(cliente.telefone, margin + 20, yPos);
        yPos += 5;
      }
      
      if (cliente.email) {
        doc.setFont(undefined, 'bold');
        doc.text('Email:', margin + 3, yPos);
        doc.setFont(undefined, 'normal');
        doc.text(cliente.email, margin + 20, yPos);
        yPos += 5;
      }
      
      if (cliente.endereco) {
        doc.setFont(undefined, 'bold');
        doc.text('Endereço:', margin + 3, yPos);
        doc.setFont(undefined, 'normal');
        const endLinhas = doc.splitTextToSize(cliente.endereco, contentWidth - 25);
        doc.text(endLinhas, margin + 20, yPos);
        yPos += 5 * endLinhas.length;
      }
      
      yPos += 8;
      
      // Produtos
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.text('PRODUTOS', margin, yPos);
      yPos += 7;
      
      // Cabeçalho da tabela
      doc.setFillColor(59, 130, 246);
      doc.rect(margin, yPos - 4, contentWidth, 7, 'F');
      
      doc.setFontSize(8);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(255, 255, 255);
      doc.text('PRODUTO', margin + 2, yPos);
      doc.text('QTD', margin + 105, yPos, { align: 'center' });
      doc.text('VALOR UNIT.', margin + 135, yPos, { align: 'right' });
      doc.text('TOTAL', contentWidth + margin - 2, yPos, { align: 'right' });
      yPos += 5;
      
      // Linhas da tabela
      doc.setTextColor(0, 0, 0);
      doc.setFont(undefined, 'normal');
      produtos.forEach((item, index) => {
        if (index % 2 === 0) {
          doc.setFillColor(250, 250, 250);
          doc.rect(margin, yPos - 4, contentWidth, 6, 'F');
        }
        
        const nomeLinhas = doc.splitTextToSize(item.nome, 95);
        doc.text(nomeLinhas[0], margin + 2, yPos);
        doc.text(String(item.quantidade), margin + 105, yPos, { align: 'center' });
        doc.text(formatCurrency(item.preco), margin + 135, yPos, { align: 'right' });
        doc.text(formatCurrency(item.preco * item.quantidade), contentWidth + margin - 2, yPos, { align: 'right' });
        yPos += 6;
      });
      
      yPos += 2;
      doc.setDrawColor(200, 200, 200);
      doc.line(margin, yPos, pageWidth - margin, yPos);
      yPos += 7;
      
      // Totais
      doc.setFillColor(239, 246, 255);
      doc.rect(margin + 100, yPos - 4, contentWidth - 100, 25, 'F');
      
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.text('Subtotal:', margin + 105, yPos);
      doc.text(formatCurrency(pedido.subtotal), contentWidth + margin - 2, yPos, { align: 'right' });
      yPos += 6;
      
      if (pedido.desconto > 0) {
        doc.setTextColor(220, 38, 38);
        doc.text(`Desconto (${pedido.desconto}%):`, margin + 105, yPos);
        doc.text(`- ${formatCurrency((pedido.subtotal * pedido.desconto) / 100)}`, contentWidth + margin - 2, yPos, { align: 'right' });
        yPos += 6;
        doc.setTextColor(0, 0, 0);
      }
      
      doc.setFont(undefined, 'bold');
      doc.setFontSize(14);
      doc.setTextColor(37, 99, 235);
      doc.text('TOTAL:', margin + 105, yPos);
      doc.text(formatCurrency(pedido.total), contentWidth + margin - 2, yPos, { align: 'right' });
      doc.setTextColor(0, 0, 0);
      yPos += 10;
      
      // Pagamento
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.text('PAGAMENTO', margin, yPos);
      yPos += 7;
      
      doc.setFillColor(245, 247, 250);
      const pagamentoHeight = pedido.valorSinal ? 35 : (pedido.valorRecebido ? 20 : 10);
      doc.rect(margin, yPos - 4, contentWidth, pagamentoHeight, 'F');
      
      doc.setFontSize(9);
      doc.setFont(undefined, 'bold');
      doc.text('Forma de Pagamento:', margin + 3, yPos);
      doc.setFont(undefined, 'normal');
      doc.text(pedido.formaPagamento, margin + 40, yPos);
      yPos += 5;
      
      if (pedido.valorRecebido) {
        doc.setFont(undefined, 'bold');
        doc.text('Valor Recebido:', margin + 3, yPos);
        doc.setFont(undefined, 'normal');
        doc.text(formatCurrency(pedido.valorRecebido), margin + 40, yPos);
        
        doc.setFont(undefined, 'bold');
        doc.text('Troco:', margin + 100, yPos);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(22, 163, 74);
        doc.text(formatCurrency(pedido.troco), margin + 115, yPos);
        doc.setTextColor(0, 0, 0);
        yPos += 5;
      }
      
      if (pedido.valorSinal) {
        doc.setFont(undefined, 'bold');
        doc.text('Valor do Sinal:', margin + 3, yPos);
        doc.setFont(undefined, 'normal');
        doc.text(formatCurrency(pedido.valorSinal), margin + 40, yPos);
        
        doc.setFont(undefined, 'bold');
        doc.text('Valor Restante:', margin + 100, yPos);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(249, 115, 22);
        doc.text(formatCurrency(pedido.valorRestante), margin + 130, yPos);
        doc.setTextColor(0, 0, 0);
        yPos += 5;
        
        if (pedido.formaPagamentoRestante) {
          doc.setFont(undefined, 'bold');
          doc.text('Forma Pgto. Restante:', margin + 3, yPos);
          doc.setFont(undefined, 'normal');
          doc.text(pedido.formaPagamentoRestante, margin + 40, yPos);
          yPos += 5;
        }
        
        if (pedido.dataProximoPagamento) {
          doc.setFont(undefined, 'bold');
          doc.text('Data Próximo Pagamento:', margin + 3, yPos);
          doc.setFont(undefined, 'normal');
          doc.text(formatDate(pedido.dataProximoPagamento), margin + 50, yPos);
          yPos += 5;
        }
      }
      
      // Rodapé
      doc.setDrawColor(200, 200, 200);
      doc.line(margin, pageHeight - 20, pageWidth - margin, pageHeight - 20);
      
      doc.setFontSize(7);
      doc.setTextColor(107, 114, 128);
      doc.text(`Documento gerado em ${formatDateTime(new Date().toISOString())}`, pageWidth / 2, pageHeight - 15, { align: 'center' });
      if (config.empresa_site) {
        doc.text(config.empresa_site, pageWidth / 2, pageHeight - 10, { align: 'center' });
      }
      
      return doc;
    }

    function imprimirPedido() {
      try {
        const doc = gerarPDFPedido();
        const pdfBlob = doc.output('blob');
        const pdfUrl = URL.createObjectURL(pdfBlob);
        
        const printWindow = window.open(pdfUrl, '_blank', 'noopener,noreferrer');
        if (printWindow) {
          printWindow.onload = function() {
            printWindow.print();
          };
        }
        
        showToast('PDF pronto para impressão!', 'success');
      } catch (error) {
        console.error('Erro ao imprimir:', error);
        showToast('Erro ao gerar PDF para impressão', 'error');
      }
    }

    function compartilharPedido() {
      try {
        const { pedido, cliente } = window.currentPedidoData;
        const doc = gerarPDFPedido();
        const pdfBlob = doc.output('blob');
        const pdfUrl = URL.createObjectURL(pdfBlob);
        
        let mensagem = `📋 *Pedido - ${pedido.status}*%0A%0A`;
        mensagem += `👤 *Cliente:* ${cliente.nome}%0A`;
        mensagem += `📅 *Data:* ${formatDate(pedido.data)}%0A`;
        mensagem += `💰 *Total:* ${formatCurrency(pedido.total)}%0A`;
        mensagem += `💳 *Pagamento:* ${pedido.formaPagamento}%0A%0A`;
        mensagem += `📄 Veja o PDF completo do pedido em anexo.`;
        
        if (cliente.telefone) {
          const telefone = cliente.telefone.replace(/\D/g, '');
          const whatsappUrl = `https://wa.me/55${telefone}?text=${mensagem}`;
          window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
        } else {
          const whatsappUrl = `https://wa.me/?text=${mensagem}`;
          window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
        }
        
        showToast('Abrindo WhatsApp para compartilhar. Baixe o PDF e anexe manualmente.', 'info');
        
        setTimeout(() => {
          const link = document.createElement('a');
          link.href = pdfUrl;
          link.download = `pedido-${cliente.nome.replace(/\s+/g, '-').toLowerCase()}-${formatDate(pedido.data).replace(/\//g, '-')}.pdf`;
          link.click();
          URL.revokeObjectURL(pdfUrl);
        }, 1000);
        
      } catch (error) {
        console.error('Erro ao compartilhar:', error);
        showToast('Erro ao gerar PDF para compartilhamento', 'error');
      }
    }

    function baixarPDF() {
      try {
        const { cliente, pedido } = window.currentPedidoData;
        const doc = gerarPDFPedido();
        
        const nomeArquivo = `pedido-${cliente.nome.replace(/\s+/g, '-').toLowerCase()}-${formatDate(pedido.data).replace(/\//g, '-')}.pdf`;
        doc.save(nomeArquivo);
        
        showToast('PDF baixado com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao baixar PDF:', error);
        showToast('Erro ao gerar PDF para download', 'error');
      }
    }

    async function alterarStatusPedido(pedido, novoStatus) {
      if (!window.dataSdk) return;
      
      const pedidoAtualizado = {
        ...pedido,
        status: novoStatus
      };
      
      const result = await window.dataSdk.update(pedidoAtualizado);
      
      if (result.isOk) {
        showToast(`Status alterado para ${novoStatus}`, 'success');
      } else {
        showToast('Erro ao alterar status', 'error');
      }
    }

    async function excluirPedido(pedido) {
      if (!window.dataSdk) return;
      
      const result = await window.dataSdk.delete(pedido);
      
      if (result.isOk) {
        showToast('Pedido excluído com sucesso', 'success');
      } else {
        showToast('Erro ao excluir pedido', 'error');
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a23d586141f488f',t:'MTc2Mzc2NjM0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>